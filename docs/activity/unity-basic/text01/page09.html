<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>9. 反発</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: Unity 入門</a></li>
<li>学習項目: [1] Unity の基本</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
次は物体の反発を Unity を使って再現してみましょう。
</p>

<p>
まず今のままでは TAMA はどこまでも落ちていくので床を用意します。
<br>
ヒエラルキー右クリック → 3D Object → Quad で平面を新規作成し、名前を「YUKA」、Position を (0,-2,0)、 Rotation を (90,0,0)、Scale を (10,10,10) にして下さい。
<br>
この時の状況が図1になります。
<br>
この状態で実行ボタンを押すと全く反発せずにそのまま YUKA に TAMA がくっつきます。
</p>

<p>
<b>図1. 床を用意</b>
</p>

<img src="./img/page09-fig1.png" alt="">

<br>
<br>
<p>
では反発の設定をしていきます。
<br>
反発を行うためには「物理マテリアル(Physic Material)」というアセットを作ります。
</p>

<p>
※ <a href="./page06.html">色とテクスチャの設定</a>で使った「マテリアル」とは違う種類のアセットなので注意して下さい
</p>

<p>
さて物理マテリアルもアセットなのでアセットフォルダの中に作成しますが、もし Scenes フォルダを開いたままにしている人は一つ上のフォルダ(TAMA Image などが置いてあるフォルダ) に戻って下さい。
<br>
それからアセットフォルダの空いている部分を右クリックしてメニューを表示し、Create → Physic Material を選びます。
するとアセットフォルダ内に「New Physic Material」というアセットが出来ますので「TAMA Physic Material」に名前を変更して下さい。
</p>

<p>
※ 繰り返しますが Material の方を選ばないよう気を付けて下さい
</p>

<p>
次に「TAMA Physic Material」をクリックしてインスペクタを表示し、Dynamic Friction を 0、Static Friction を 0、Bounciness を 0.98 にして下さい。
<br>
このうち最初の2つは摩擦の設定なのでこの後説明します。
<br>
反発は最後の Bounciness の値で設定します。
</p>

<p>
値を設定したらアセットフォルダ内の「TAMA Physic Material」をドラッグしてヒエラルキーの「TAMA」の上にドロップして下さい。
<br>
すると「TAMA」のインスペクタの Sphere Collider の中に「TAMA Physic Material」が表示されるので反発の設定がされたことが分かります。
</p>

<p>
同様に「YUKA Physic Material」を作成し、Dynamic Friction を 0、Static Friction を 0、Bounciness を 0.98 にし、「YUKA」にドラッグ＆ドロップして下さい。
</p>

<p>
ここまで出来たら早速実行ボタンを押してみましょう。
<br>
TAMA が跳ね返ってだいたい元の位置まで戻る事が分かります。
</p>

<p>
※ 計算誤差があるので完全に同じ位置までは戻りません
</p>

<p>
次に「TAMA Physic Material」と「YUKA Physic Material」の Bounciness を両方とも 0.69 にして実行して下さい。
<br>
すると反発力が落ちて跳ね返るたびに元の半分の高さまでしか戻らなくなります。
</p>

<p>
最後に「TAMA Physic Material」と「YUKA Physic Material」の Bounciness を両方とも 0 にして実行して下さい。
<br>
すると全く反発しなくなります。
</p>

<p>
この様に、Bounciness の値が 1 に近いと反発力が強くなり、逆に 0 に近づくにつれて反発力が落ちていきます。
</p>

<br>
<h3>
2. Bounciness の詳しい説明
</h3>

<p>
ここから先は少し難しい話なので分からなければ飛ばしても結構です。
<br>
ただし Unity の物理演算機能を使いこなすためには大事な知識ですので興味のある人は是非トライして下さい。
</p>

<p>
Physic Material の Bounciness について詳しく説明する前に現実世界の<a href="https://ja.wikipedia.org/wiki/%E5%8F%8D%E7%99%BA%E4%BF%82%E6%95%B0">反発係数</a>についておさらいしておきます。

<p>
TAMA と YUKA がぶつかった時に TAMA の速度が v1 から v1' 、YUKA の速度が v2 から v2' に変わったとしたら反発係数は
</p>

<p>
反発係数 = |v1' - v2'| / |v1 - v2|
</p>

<p>
となりますが、今回のシチュエーションでは YUKA は静止している(v2 = v2' = 0)ので
</p>

<p>
反発係数 = |v1'| / |v1|
</p>

<p>
となります。
</p>

<p>
ここで e = 1 の状況を完全弾性衝突と呼んで、 TAMA の反発後の速度は不変で方向だけ変わります(つまり v1' = -v1 )。
<br>
逆に e = 0 の状況を完全非弾性衝突と呼んで、 TAMA の反発後の速度は v1' = 0 となります。
<br>
また e が 1 より大きい場合は跳ね返った後の速度の方が早くなります(トランポリンのイメージ)。
</p>

<p>
以上の話を踏まえて Bounciness の話に戻ります。
<br>
結論から言うと Bounciness ≒ 反発係数になります。
</p>

<p>
※ 完全にイコールでない理由についてはこれから順を追って説明します
</p>

<p>
まず TAMA と YUKA がぶつかった時に使われる Bounciness の値はデフォルトでは TAMA と YUKA の Bounciness の平均値になります。
<br>
今回は両方とも同じ値を使う様にしていたので Bounciness の平均値も同じになりますが、もし平均値を使いたくない場合は Physic Material の Bounce Combine を Average(平均) から他の設定に変えます。
</p>
<p>
例えば自分のキャラクターには反発を設定せずに床とか壁とかに反発の設定を任せたい時があります(金属の床とかマットレスとかトランポリンとか色々な状況が考えられますね)。
<br>
その場合は 自分のキャラクターの Bounciness を 0、Bounce Combine を Maximum にします。
<br>
ここでは Bounce Combine についてこれ以上詳しく説明しませんので、興味のある人は調べてみて下さい。
</p>

<p>
次に、Unity の物理演算エンジンは反発する時に若干運動エネルギーを加えます(計算誤差を補正するため？)。
<br>
そのため Bounciness の値を 1 にすると反発後の速度の方が若干早くなります。
<br>
従って Bounciness の値は現実の反発係数よりも若干小さめの値にする必要があります(理論的にどの位小さくすれば良いかは未調査です)。
<br>
上の方で Bounciness の値を 0.98 にしていた理由はそのためです。
</p>

<p>
この様な Unity 特有の癖にさえ気をつければ後は普通の反発係数と同様に計算できます。
<br>
例えば上の例の様に反発後に戻る高さを元の 1/2 にしたい場合は Bounciness の値をいくつにすればよいか考えてみましょう。
</p>

<p>
戻る高さが半分になるということは反発時に位置エネルギーの半分が失われるということを意味します。
<br>
つまり衝突時に運動エネルギーが半分になるということなので、TAMA の重さを m 、反発前の速度を v1 、反発後の速度を v1' とすると
<p>

<p>
m * v1' * v1' / 2 = (m * v1 * v1 / 2 ) /2
</p>

<p>
という式が成り立ちます。
<br>
これを解くと |v1'| = |v1|/ √2 なので反発係数 = |v1'|/|v1| = 1/√2 = 0.707106781 となります。
</p>

<p>
ただし Bounciness の値は現実の反発係数よりも若干小さめにしないと駄目なので今回は Bounciness = 0.69 としています。
</p>

<br>
<script>PreNext(9,10)</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>5. ゲームパッドやキーボードによるゲームオブジェクトの移動</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: オブジェクト指向開発入門</a></li>
<li>学習項目: [1] Unity の基本(2D編)</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
ゲームパッドやキーボード上の指定したボタンを押しているかどうかを判定するには、Input というユーティリティクラスにある GetAxis〜、GetButton〜、GetKey〜メソッドを利用します。 
<br>
それらのメソッドは用途ごとに使い分けることが出来ますが、今回は GetAxisRaw メソッドと GetButton メソッドを用いることにします。
<br>
その他のメソッドの使い方は自分で調べて下さい。
</p>

<p>
まずGetAxisRaw メソッドは、ゲームパッドやカーソルキーなどの方向ボタンを押しているかどうか判定するメソッドです。
</p>

<div class="info">
<input type="checkbox"><b>方向ボタンを押しているか判定</b>
<pre class="wrap">
public static float Input.GetAxisRaw( "軸" );

戻り値(float): キー状態に従って -1 か 0 か 1 が戻る

"軸":
"Horizontal" なら右を押してれば 1、左を押してれば -1 、押してないと 0 が戻る
"Vertical" なら上を押してれば 1、下を押してれば -1、押してないと 0 が 戻る
</pre>

<p>
※ キーパッドによっては GetAxisRaw メソッドが上手く動作しない場合もあります。その場合は GetAxis メソッドの方を使って下さい。
</p>

</div>

<p>
次に GetButton メソッドは、攻撃ボタンとかジャンプボタンなどのボタンを押しているかどうかを判定するメソッドです。
</p>

<div class="info">
<input type="checkbox"><b>指定したボタンを押しているか判定</b>
<pre class="wrap">
public static bool Input.GetButton( "ボタンの名前" );

戻り値(bool): 指定したボタンを押してれば true、押してなければ false が戻る 

"ボタンの名前":
"Fire1"、"Fire2"、"Fire3"、"Jump" など
</pre>
</div>

<p>
これらのメソッドと<a href="./page04.html">前ページ</a>で学んだ Rigidbody2D の velocity プロパティを組み合わせればユーザーの入力に従って自由にオブジェクトを動かせるようになります。
<br>
なお
</p>

<p>
「<b>Rigidbody2D の機能を利用するコードは、Update メソッドではなくて FixedUpdate メソッド内に書かなければいけない</b>」
</p>

<p>
という制約がありますので(※)、Rigidbody2D の velocity プロパティの値を変更するにはまず void FixedUpdate() というメソッドをスクリプトに追加してからその中に書きます。
</p>

<p>
※ 正確には GetAxisRaw などの Input 系のメソッドは Update メソッド、Rigidbody2D の機能は FixedUpdate メソッドの中に書く必要があります(理由は自分で調べてみましょう)。
<br>
今回は説明を簡単にするため Input 系のメソッドも FixedUpdate 内にまとめて書くことにします。
</p>

<p>
例えばあるゲームオブジェクトを(重力が 0 なら) 方向キーで入力した方向に速度 2.0 で動かしたい場合はソース 1 の様に FixedUpdate メソッド内に書きます。 
</p>

<div class="info">
<input type="checkbox"><b>ソース 1: ゲームオブジェクトを方向ボタンで入力した方向に速度 2.0 で動かす</b>
<pre class="wrap">
float speed = 2.0f;
float x = Input.GetAxisRaw ("Horizontal"); // 右を押してれば 1、左を押してれば -1 、押してないと 0 が x に入る
float y = Input.GetAxisRaw ("Vertical"); // 上を押してれば 1、下を押してれば -1、押してないと 0 が y に入る
Vector2 v = new Vector2( x, y ).normalized; // ※ .normalized はベクトル v を長さ 1 に正規化するの意味
GetComponent&lt;Rigidbody2D&gt;().velocity = v * speed;
</pre>
</div>

<p>
ちなみに方向ボタンを押した方向にゲームオブジェクトの画像の向きもそれに合わせて変更したい場合があります。
<br>
それを実現するには、ソース 2 の様に Sprite Renderer コンポーネントの flipX 又は FlipY プロパティの値を次のように変更します。
</p>

<div class="info">
<input type="checkbox"><b>ソース 2 : 画像の向きを反転させる</b>
<pre class="wrap">

GetComponent&lt;SpriteRenderer&gt;().flipX = false; // 左右を通常の向きにする

GetComponent&lt;SpriteRenderer&gt;().flipX = true; // 左右を反転させる

GetComponent&lt;SpriteRenderer&gt;().flipY = false; // 上下を通常の向きにする

GetComponent&lt;SpriteRenderer&gt;().flipY = true; // 上下を反転させる
</pre>
</div>


<br>
<script>PreNext(5,10)</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>6. 分岐処理</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: Unity 入門</a></li>
<li>学習項目: [2] Visual Scripting</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
分岐処理は If ユニットや Switch ユニットなどを使って行います。
<br>
また純粋な分岐処理とは少し違うのですが、Select ユニット、Sequence ユニット、 Once ユニットの使い方も説明します。
</p>

<br>
<h3>
1. 準備
</h3>

<p>
まず準備です。
<br>
分岐処理テスト用に別の Script Graph を用意します
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> アセットフォルダの空いている部分を右クリックしてメニューを表示し、Create → Visual Scripting → Script Graph を選ぶ
<br>
<span class="olradio"><input type="radio" name="p1"></span> アセットフォルダ内に「New Script Graph」というアセットが出来るので「If Script Graph」に名前を変更する
<br>
<span class="olradio"><input type="radio" name="p1"></span> ヒエラルキーの PROGRAM をクリックしてインスペクタを表示する
<br>
<span class="olradio"><input type="radio" name="p1"></span> Script Machine の Graph の Math Script Graph と書いてあるセルにアセットフォルダの If Script Graph をドロップする 
<br>
<span class="olradio"><input type="radio" name="p1"></span> すると If Script Graph が実行されるようになる
</p>
</div>

</div>


<br>
<h3>
2. If ユニット
</h3>

<p>
さて初歩的な分岐処理は If ユニット(if で検索)を使って行えます。
<br>
If ユニットの左下の値入力ポートには正(True)か偽(False)を入力し、もし True が入力されたら右側の True のコントロール出力ポートに繋がっているユニットに制御が移ります。
<br>
一方、False が入力されたら False のコントロール出力ポートに繋がっているユニットに制御が移ります。
</p>

<p>
さて If ユニットの左下の値入力ポートにはイコールや大なり小なり等の判定用ユニットを接続します。
<br>
幸いなことに、値入力ポートからドラッグしてユニット検索ダイアログを開くと代表的な判定用ユニット一覧が表示されるので、それ程使い方には迷わないと思います。
<br>
またはユニット検索ダイアログの Logic の項目に判定用ユニットがあります。
</p>

<p>
では早速図1のサンプルを実行してみて下さい。
<br>
まずランダムで 0 から 9 までの整数を生成して表示します(Random:Range は Max Exclusive 版)。
<br>
次に生成した数字が 5 以下なら Good、6 以上なら Bad と表示します。
<br>
最後に合流して OK と表示します。
</p>

<br>
<b>図1. If ユニットの例 </b>
<br>
<img src="./img/page06-fig1.png" alt="">



<br>
<br>
<h3>
3. Switch ユニット
</h3>

<p>
次は Switch ユニット(switchで検索)です。
<br>
Switch ユニットは入力された選択肢(セレクター)に従って制御を切り替えるという処理を行います。
<br>
では早速以下の手順で Switch ユニットを作ってみましょう。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> Switch ユニットにはいくつか種類があるが、今回は Switch On Integer (in Control) ユニットを作る(以後 Switch ユニットと略します)
<br>
<span class="olradio"><input type="radio" name="p1"></span> 作成した Switch ユニットをクリックするとグラフインスペクタに Options という項目が表示される
<br>
<span class="olradio"><input type="radio" name="p1"></span> Options の隣の＋ポタンを押すと選択肢を追加出来る。今回は＋ポタンを3回押す
<br>
<span class="olradio"><input type="radio" name="p1"></span> すると選択肢が 3 つ出来る。今回は整数(Integer型)を選択肢とするので上から 0、1、2 を入れる(図2)
<br>
<span class="olradio"><input type="radio" name="p1"></span> Switch ユニットに 0、1、2 に対応したコントロール出力ポートが出来る( Default はどれでも無い場合)
</p>
</div>

</div>

<br>
<b>図2. Switch ユニットのグラフインスペクタの Options 設定</b>
<br>
<img src="./img/page06-fig2.png" alt="">

<br>
<p>
では早速図3のサンプルを実行してみて下さい。
<br>
まずランダムで 0 から 2 までの整数を生成して表示します(Random:Range は Max Exclusive 版)。
<br>
次に生成した数字に合わせて Switch ユニットで分岐します。
<br>
なお今回は Default は使っていません。
<br>
最後に合流して OK と表示します。
</p>

<br>
<b>図3. Switch ユニットの例 </b>
<br>
<img src="./img/page06-fig3.png" alt="">


<br>
<br>
<h3>
4. Select On Integer
</h3>

<p>
次は Select ユニット( select on で検索)です。
<br>
Select ユニットは厳密には分岐処理では無いのですが、If ユニットや Switch ユニット代わりに使えることが多いのでここで説明します。
<br>
Switch ユニットにはいくつか種類がありますが、今回は Select On Integer と Select On Flow について説明します。
</p>

<p>
まず Select On Integer ユニットは数字の選択肢に従って値を返すというユニットです。
<br>
とりあえず以下の手順でユニットを作ってみましょう。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> Select ユニットにはいくつか種類があるが、今回は Select On Integer (in Control) ユニットを作る(以後 Select ユニットと略します)
<br>
<span class="olradio"><input type="radio" name="p1"></span> 作成した Select ユニットをクリックするとグラフインスペクタに Options という項目が表示される
<br>
<span class="olradio"><input type="radio" name="p1"></span> Options の隣の＋ポタンを押すと選択肢を追加出来る。今回は＋ポタンを3回押す
<br>
<span class="olradio"><input type="radio" name="p1"></span> すると選択肢が 3 つ出来る。今回は整数(Integer型)を選択肢とするので上から 0、1、2 を入れる(図4)
<br>
<span class="olradio"><input type="radio" name="p1"></span> Select ユニットに 0、1、2 に対応した値出力ポートが出来る( Default はどれでも無い場合)
</p>
</div>

</div>

<br>
<b>図4. Select ユニットのグラフインスペクタの Options 設定</b>
<br>
<img src="./img/page06-fig4.png" alt="">

<br>
<p>
では早速図5のサンプルを実行してみて下さい(Random:Range は Max Exclusive 版)。
<br>
図 3 と全く同じことをしているスクリプトです。
<br>
まずランダムで 0 から 2 までの整数を生成して表示します。
<br>
次に生成した数字に合わせて Select ユニットで文字列を選択して表示します。
<br>
なお今回は Default は使っていません(ただ Default を指定しないとユニットがオレンジの警告色になるので普通は指定した方が良いです)。
<br>
図3 と同じことをしているのに、かなりスッキリしました。
</p>

<br>
<b>図5. Select On Integer ユニットの例 </b>
<br>
<img src="./img/page06-fig5.png" alt="">


<br>
<br>
<h3>
5. Select On FLow
</h3>

<p>
Select On Flow ユニットは分岐処理ではなく、逆に処理が合流するときにやって来た経路に従って値を返すというユニットです。
<br>
合流する処理の数はユニット内の Branches の隣に入れます。
</p>

<p>
多分実際に動かした方が分かりやすいと思うので、以下の図6のサンプルを実行してみて下さい。
<br>
これも 図 3、図5 と全く同じことをしているスクリプトです。
<br>
まずランダムで 0 から 2 までの整数を生成して表示します(Random:Range は Max Exclusive 版)。
<br>
次に生成した数字に合わせて Switch ユニットで処理を分岐します。
<br>
そして合流時に Select On Flow を使って文字列を選択して表示します(Branches の数を 3 にするのを忘れずに)。
<br>
なお今回は Default は使っていません。
</p>

<p>
今回はあまり良い例ではありませんが、使い方次第ではいろいろ面白いことが出来そうです。
</p>

<br>
<b>図6. Select On Flow ユニットの例 </b>
<br>
<img src="./img/page06-fig6.png" alt="">

<br>
<br>
<h3> 6. Sequence ユニット
</h3>

<p>
Sequence ユニット(sequence で検索)は一応分岐処理ではあるのですが、If や Switch みたいな条件は必要なくて、単に上から順に処理を行うだけというユニットです。
<br>
実行する処理の数はユニット内の Steps の隣に入れます。
</p>

<p>
こちらも多分実際に動かした方が分かりやすいと思うので、以下の図7のサンプルを実行してみて下さい。
<br>
今回は乱数を使わず、Sequence ユニットから矢印を Select On Flow に直接繋いでいます(Steps の数を 3 にするのを忘れずに)。。
<br>
すると上の矢印から順に実行されるので、Good、Normal、Bad の順に表示がされます。
</p>

<p>
このユニットを上手く使うとスッキリとした綺麗なスクリプトが描けそうな感じがしますね。
</p>

<br>
<b>図7. Sequence ユニットの例 </b>
<br>
<img src="./img/page06-fig7.png" alt="">


<br>
<br>
<h3> 7. Once ユニット
</h3>

<p>
Once ユニット(once で検索)は最初に一回だけ Once に繋がっている処理を実行し、それ以降は After に繋がった処理を実行するというユニットです。
<br>
なお Reset にフローを入力するとリセットされます。
</p>

<p>
こちらも多分実際に動かした方が分かりやすいと思うので、以下の図8のサンプルを実行してみて下さい。
<br>
Sequence ユニットから Once ユニットのコントロール入力ポートに矢印を繋いでいますが、3番のみ Reset に矢印を繋いでいます(Steps の数を 7 にするのを忘れずに)。
<br>
すると Once、After、After と表示がされた後にリセットがかかり再び Once、After、After と表示されます。
</p>

<p>
何か一度だけ実行したい処理がある時など便利そうです(わざわざフラグを用意しなくても良いので)。
</p>

<br>
<b>図8. Once ユニットの例 </b>
<br>
<img src="./img/page06-fig8.png" alt="">


<br>
<br>
<script>PreNext(6,10)</script>
</body>
</html>

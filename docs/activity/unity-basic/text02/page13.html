<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>13. シーンの切替</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: Unity 入門</a></li>
<li>学習項目: [2] Visual Scripting</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
ゲームはタイトル画面、キャラクター選択画面、プレイ画面、ゲームオーバー画面など様々なシーンから出来ています。
<br>
スクリプトを使うとこれらのシーンを切り替えることが出来ます。
</p>

<br>
<h3>
1. 準備
</h3>

<p>
まず準備です。
<br>
テスト用にシーンを 2 つ新規作成し、Script Graph も新たに設定します。
</p>

<p>
まず1つ目のシーンです。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> アセットフォルダの Scenes フォルダの中に<a href="../text01/page08.html">シーンを新規作成</a>し、シーン名を「SC1 Scene」にする。背景色は任意で構わない 
<br>
<span class="olradio"><input type="radio" name="p1"></span> 新規作成したシーンへ移動する
<br>
<span class="olradio"><input type="radio" name="p1"></span> ヒエラルキー右クリック → 3D Object → Sphere で球を新規作成し、名前を「TAMA」、Position を (-5,0,0)にする
<br>
<span class="olradio"><input type="radio" name="p1"></span> Scripts フォルダの中に入り、空いている部分を右クリックしてメニューを表示し、Create → Visual Scripting → Script Graph を選ぶ
<br>
<span class="olradio"><input type="radio" name="p1"></span> Scripts フォルダ内に「New Script Graph」というアセットが出来るので「SC1 Script」に名前を変更する
<br>
<span class="olradio"><input type="radio" name="p1"></span> TAMA に Script Machine コンポーネントをアタッチする 
<br>
<span class="olradio"><input type="radio" name="p1"></span> Script Machine の Graph の None と書いてあるセルに SC1 をドロップする 
</p>
</div>

</div>

<p>
同様に2つ目のシーンを作成します。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> アセットフォルダの Scenes フォルダの中に<a href="../text01/page08.html">シーンを新規作成</a>し、シーン名を「SC2 Scene」にする。背景色は任意で構わない 
<br>
<span class="olradio"><input type="radio" name="p1"></span> 新規作成したシーンへ移動する
<br>
<span class="olradio"><input type="radio" name="p1"></span> ヒエラルキー右クリック → 3D Object → Cube で立方体を新規作成し、名前を「HAKO」、Position を (5,0,0)にする
<br>
<span class="olradio"><input type="radio" name="p1"></span> Scripts フォルダの中に入り、空いている部分を右クリックしてメニューを表示し、Create → Visual Scripting → Script Graph を選ぶ
<br>
<span class="olradio"><input type="radio" name="p1"></span> Scripts フォルダ内に「New Script Graph」というアセットが出来るので「SC2 Script」に名前を変更する
<br>
<span class="olradio"><input type="radio" name="p1"></span> HAKO に Script Machine コンポーネントをアタッチする 
<br>
<span class="olradio"><input type="radio" name="p1"></span> Script Machine の Graph の None と書いてあるセルに SC2 をドロップする 
</p>
</div>

</div>

<br>
<h3>
2. シーンの登録
</h3>

<p>
シーンの切替をする前にシーンをビルド設定に登録する必要があります。
<br>
以下の手順で登録をして下さい。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> シーンを SC1 Scene に切り替える
<br>
<span class="olradio"><input type="radio" name="p1"></span> File メニュー → Build Setting でビルド設定ダイアログを開く
<br>
<span class="olradio"><input type="radio" name="p1"></span> Add Open Scenes ボタンを押すと現在開いているシーン(SC1 Scene)が Scenes in Build の欄に登録される
<br>
<span class="olradio"><input type="radio" name="p1"></span> SC2 Scene に切り替える
<br>
<span class="olradio"><input type="radio" name="p1"></span> もう一度 Add Open Scenes ボタンを押すと現在開いているシーン(SC2 Scene)が Scenes in Build の欄に登録される
<br>
<span class="olradio"><input type="radio" name="p1"></span> この時点で Scenes in Build の内容が図 1 の様になっているのを確認したら設定ダイアログを閉じる
</p>
<p>
<b>図1. シーンの登録 </b>
</p>
<img src="./img/page13-fig1.png" alt="">
</div>

</div>



<br>
<h3>
3. シーンの切替
</h3>

<p>
ではシーンの切替をしてみましょう。
</p>

<p>
シーン切替を行うユニットは Scene Manager Load Scene ユニットです。
<br>
ユニット内の Scene Name にシーン名を入れます。
</p>

<p>
まず SC1 Script に 図 2 を入力して下さい。
<br>
Jump ボタンを押すと SC2 Scene に切り替わります。
</p>

<br>
<p>
<b>図2. SC1 Script </b>
</p>
<img src="./img/page13-fig2.png" alt="">

<p>
次に SC2 Script に 図 2 を入力して下さい。
<br>
5 秒経過すると自動で SC1 Scene に切り替わります。
<br>
Start イベントを<a href="./page12.html">コルーチン化</a>するのを忘れないで下さい。
</p>

<br>
<p>
<b>図4. SC2 Script </b>
</p>
<img src="./img/page13-fig3.png" alt="">


<br>
<h3>
4. 切り替えたシーンが暗い場合
</h3>

<p>
さて図1、図2を入力したら実行してみてください。
<br>
すると切り替えたシーンのゲームオブジェクトが図 4 の様に暗くなっていることに気がつくと思います。
<br>
この理由はシーンに光源の設定がされていないためです。
</p>

<br>
<p>
<b>図5. シーンを切り替えるとゲームオブジェクトが暗くなる </b>
</p>
<img src="./img/page13-fig4.png" alt="">

<p>
この現象を解決するには以下の手順でシーンごとに光源設定をする必要があります。
</p>

<div class="info">

<div class="olradio"> 
<p>
<span class="olradio"><input type="radio" name="p1"></span> シーンを SC1 Scene に切り替える
<br>
<span class="olradio"><input type="radio" name="p1"></span> Window メニュー → Rendering → Lighting で光源設定ダイアログを表示する
<br>
<span class="olradio"><input type="radio" name="p1"></span> (もしチェックされてたら) ダイアログの下にある Auto Generate のチェックを外す
<br>
<span class="olradio"><input type="radio" name="p1"></span> ダイアログの下にある Generate Lighting ボタンを押す
<br>
<span class="olradio"><input type="radio" name="p1"></span> するとアセットフォルダの Scenes フォルダの中に SC1 Scene というフォルダが出来て、中に光源設定が保存される
<br>
<span class="olradio"><input type="radio" name="p1"></span> SC2 Scene に切り替える
<br>
<span class="olradio"><input type="radio" name="p1"></span> (もしチェックされてたら) ダイアログの下にある Auto Generate のチェックを外す
<br>
<span class="olradio"><input type="radio" name="p1"></span> Generate Lighting ボタンを押す
<br>
<span class="olradio"><input type="radio" name="p1"></span> するとアセットフォルダの Scenes フォルダの中に SC2 Scene というフォルダが出来て、中に光源設定が保存される
</div>

</div>

<p>
なおこの光源設定は画面上に静的ゲームオブジェクト(static GameObject)を配置したり削除したりしたら毎回手動でおこなう必要があります。
<br>
いちいち手動で Generate Lighting ボタンを押すのが面倒な場合は Auto Generate をチェックしすれば自動で設定してくれますが、結構重い処理なので PC の性能がいまいちな場合は OFF にしておいた方が無難でしょう。
</p>

<br>
<br>
<script>PreNext(13,14)</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>演習</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: 入出力インターフェース</a></li>
<li>学習項目: [4] PWM</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
演習時間: 40  分
</p>

<br>
<h2><a href="./page01.html">1. PWM とは</a></h2>

<p>
演習なし
</p>

<br>
<h2><a href="./page02.html">2. 出力</a></h2>

<pre>

プレスケール: 64 倍

使用するピン: RB3/CCP1 (9 pin) を pwm 出力(CCP1)とする

レジスタ設定:

CCP1SEL = x ・・・ Pin Selection bit  (118p, APFCON0 の bit0)
CCPTMRS = 0x00 ・・・ デフォルト(Timer2使用)  CCP TIMERS CONTROL REGISTER (206p)

TxCON = 0b 0 0000 1 xx  ・・・ TIMER2/TIMER4/TIMER6 CONTROL REGISTERS (p191)

CCPxCON = 0b 00 00 xxxx ・・・CCPX CONTROL REGISTER (p204)

PWM周期とパルス幅の計算式:  p212

PR2 ・・・ Timer2 Period Register (p30)
CCPRxL・・・Capture/Compare/PWM Register x Low Byte (p208)
DCxB1, DCxB0 ・・・CCPxCON の 5,4 ビット (p204)

FOSC ・・・ Frequency of Oscillator マイコンの動作周波数のこと
TOSC ・・・ Time taken per OSCillation つまり = 1/FOSC 

</pre>

<pre>
(注意)  pickit4の出力は 3.3V

(1)

PR2 = 249
CCPR1L:DC1B1:DC1B0 = 0b 01111101 0 0 = 500

の時の PWM周期とPWM幅の理論値を計算 → 実際にオシロスコープで確認する
</pre>

<pre>

(2)

圧電スピーカから「ド・レ・ミ」と鳴らす(3秒毎にチェンジ)

        printf("O3C = 131 Hz\r\n");

        // PWM周期 = 131 Hz = 7.63 ミリ秒
        // パルス幅は PWM 周期の半分とする

        printf("O3E = 165 Hz\r\n");

        // PWM周期 = 165 Hz = 6.06 ミリ秒
        // パルス幅は PWM 周期の半分とする

        printf("O3G = 196 Hz\r\n");

        // PWM 周期 = 196 Hz = 5.10 ミリ秒
        // パルス幅は PWM 周期の半分とする
</pre>

<script>PreNext(3,2)</script>
</body>
</html>

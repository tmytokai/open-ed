<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>4. 更新内容のプッシュ (衝突が有る場合)</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: git によるバージョン管理</a></li>
<li>学習項目: [3] リモートリポジトリ</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
次は衝突がある場合の演習を行います。
<br>
この場合はプルした後に手作業で衝突している部分を修正し、改めて add、commit、push をする必要があります。
</p>

<br>
<pre class="prog">
<input type="checkbox"> (1) まずBさんが作業するので、他のメンバーはBさんの作業を後から見る。
<br>
<input type="checkbox"> (2) Bさんは試しにプッシュを実行する。
<br>
git push
<br>
すると
<br>
! [rejected]
<br>
と表示される。
これはリモートリポジトリが他の人により更新されているので
先にプルしないとプッシュ出来ないということを示している。
<br>
<input type="checkbox"> (3) Bさんはプルを実行し、リモートリポジトリの更新内容を
ダウンロードしてローカルリポジトリに取り込む。
<br>
git pull
<br>
すると
<br>
CONFLICT (content)
<br>
と表示される。
これは衝突が起きたので修正しろということを示している。
<br>
<input type="checkbox"> (4) Bさんは git status でどのファイルで衝突が起きたか確認する。
<br>
git status
<br>
すると衝突が起きているファイル(hoge.txt)に対して「both modified」と表示される 。
<br>
<input type="checkbox"> (5) Bさんは git diff で衝突内容を確認する。
<br>
git diff hoge.txt
<br>
<input type="checkbox"> (6) Bさんは hoge.txt を開く。
ファイルの中身を見ると次のようになっている。
<br>
name?
<<<<<<< HEAD
B
=======
A
>>>>>>> (環境によって値が異なるコミットのハッシュ値)
<br>
=======（マーカーという)よりも上の部分が自分がローカルリポジトリに対して行った更新内容、
下がリモートリポジトリの更新内容である。
<br>
</pre>
<br>
この時点では以下の状態4になっています。
<br>
<br>
Bさんのワーキングツリーにある hoge.txt の中身にはマーカー(=======)が付いています。
<br>
これは同じ行に異なる文字(AとB)が追加されたため git がどうすれば良いのか分からなくて困っていることを意味します(※)。
<br>
<br>
※ なお更新内容が被っていない時は git は自動的に中身を修正(マージと言います)し、ついでにコミットもしてくれます。
<br>
<br>
インデックスの hoge.txt には衝突フラグが付いています。
<br>
<br>
HEAD はそのままです。
<br>
<br>
<h2>状態 4</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 20em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>
<<<<<<< HEAD
<br>
B
<br>
=======
<br>
A
<br>
>>>>>>> (ハッシュ値)
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt → 衝突
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
</td></tr></table>
</td></tr></table>
"my name is B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
"my name is C"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
"my name is D"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>
A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>

</td></tr></table>

<br>
<br>
ではこれから hoge.txt を修正してプッシュしてみましょう。
<br>
<pre class="prog">
<input type="checkbox"> (7) Bさんはマーカーを消して以下のように hoge.txt を修正する
(Aの後に改行が入っているか確認。Aの下に余計な空行が入っていないか確認)。
<br>
name? 
B 
A
<br>
<input type="checkbox"> (8) Bさんは hoge.txt を add する。
<br>
git add hoge.txt
<br>
すると hoge.txt の衝突フラグが消える。
<br>
<input type="checkbox"> (9) Bさんは git status で衝突フラグが消えている事を確認する。
<br>
git status
<br>
<input type="checkbox"> (10) Bさんは hoge.txt をコミットする
<br>
git commit -m "merged A and B"
<br>
<input type="checkbox"> (11) Bさんはプルを再実行し、リモートリポジトリの更新内容を
改めてダウンロードしてローカルリポジトリに取り込む
(もちろんこの時点では他の人はリモートリポジトリを更新してないので何も起きないが
プッシュする前にプルする習慣をつけよう)。
<br>
git pull
<br>
<input type="checkbox"> (12) Bさんはプッシュを実行してローカルリポジトリの更新内容をリモートリポジトリにアップロードする
<br>
git push
<br>
※ IDとパスワードは演習時に知らせます
<br>
<input type="checkbox"> (4) Bさんは現在のローカルリポジトリの状態を確認する
<br>
git show
<br>
<input type="checkbox"> (4) Bさんは現在のリモートリポジトリの状態を確認する
<br>
git show origin
<br>
※ 前のテキストで説明したように、origin はリモートリポジトリの別名です
</pre>

すると以下の状態5になります。
<br>
<br>
BさんのローカルリポジトリのHEADの内容がそのままリモートリポジトリにアップロードされている事が分かります。

<br>
<br>
<h2>状態 5</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
</td></tr></table>
</td></tr></table>
"my name is C"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
</td></tr></table>
</td></tr></table>
"my name is D"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>

</td></tr></table>

<br>
<br>
では続けてCさん、Dさんも順にプル＆プッシュして以下の状態6にして下さい。
<br>
<br>
<h2>状態 6</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged C and AB"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged D and ABC"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged D and ABC"
</td>

</tr></table>

</td></tr></table>

<script>PreNext(4,5)</script>
</body>
</html>

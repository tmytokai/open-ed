<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>4. 更新内容のプッシュ (衝突が有る場合)</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: Git によるバージョン管理</a></li>
<li>学習項目: [3] リモートリポジトリ</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
次は衝突がある場合の演習を行います。
<br>
この場合は pull した後に手作業で衝突している部分を修正し、改めて add、commit、push をする必要があります。
</p>

<br>
<div class="info">
<div class="olradio">
<p>
<span class="olradio"><input type="radio" name="r1"></span> まずBさんが作業するので、他のメンバーはBさんの作業を後から見る
<br>
<span class="olradio"><input type="radio" name="r1"></span> Bさんは試しに push を実行する
</p>
<p>
git push
</p>
<p>
すると
<br>
! [rejected]
<br>
と表示されるが、これはリモートリポジトリが自分より先に他の人(Aさん)により更新されているので、先に pull しないと push 出来ないということを示している
</p>
<p>
<span class="olradio"><input type="radio" name="r1"></span> Bさんは pull を実行し、リモートリポジトリの更新内容をダウンロードしてローカルリポジトリに取り込む
</p>
<p>
git pull
</p>
<p>
すると
<br>
CONFLICT (content)
<br>と表示されるが、これは衝突が起きたので修正しろということを示している
</p>
<p>
<span class="olradio"><input type="radio" name="r1"></span> Bさんは git status でどのファイルで衝突が起きたか確認する
</p>
<p>
git status
</p>
<p>
すると衝突が起きているファイル(hoge.txt)に対して「both modified」と表示される 
</p>
<p>
<span class="olradio"><input type="radio" name="r1"></span> Bさんは git diff で衝突内容を確認する
</p>
<p>
git diff hoge.txt
</p>
<p>
<span class="olradio"><input type="radio" name="r1"></span> Bさんは hoge.txt を開いて中身が以下のようになっていることを確認する
</p>
<pre>
name?
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
B
=======
A
&gt;&gt;&gt;&gt;&gt;&gt;&gt; ハッシュ値
<br>
ここで「=======」（マーカーという)よりも上の部分が自分がローカルリポジトリに対して行った更新内容、下が他の人(Aさん)がリモートリポジトリに足して更新内容を表している
</pre>
</div>
</div>

<p>
この時点では以下の状態4になっています。
</p>

<p>
Bさんのワーキングツリーにある hoge.txt の中身にはマーカー(=======)が付いていることに注目して下さい。
</p>

<p>
これは上の囲みで説明したように同じ行にローカルとリモートで異なる文字(AとB)が追加されたため git がどうすれば良いのか分からなくて困っていることを意味します。
<br>
ちなみに更新内容が被っていない時は git は自動的に中身を修正(マージといいます)してコミットまでしてくれます。
</p>

<p>
またインデックスの hoge.txt には衝突フラグが付いています。
<br>
HEAD はそのままです。
</p>

<br>
<br>
<h2>状態 4 (HEAD より前のコミットは省略)</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 20em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
<br>
B
<br>
=======
<br>
A
<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; ハッシュ値
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt → 衝突
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
</td></tr></table>
</td></tr></table>
"my name is B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
"my name is C"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
"my name is D"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>
A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>

</td></tr></table>

<p>
ではこれから Bさんは衝突している hoge.txt を修正して push してみましょう。
</p>

<div class="info">
<div class="olradio">
<p>
<span class="olradio"><input type="radio" name="r2"></span> Bさんはマーカーを消して以下のように hoge.txt を修正する。A の下に空行が入っていないように気をつけること
</p>
<pre>
name? 
B 
A
</pre>
<p>
<span class="olradio"><input type="radio" name="r2"></span> git add hoge.txt
<br>
<span class="olradio"><input type="radio" name="r2"></span> git status で衝突フラグが消えている事を確認する
<br>
<span class="olradio"><input type="radio" name="r2"></span> git commit -m "merged A and B"
<br>
<span class="olradio"><input type="radio" name="r2"></span> git pull を再実行してリモートリポジトリの更新内容を改めてダウンロードしてローカルリポジトリに取り込む(※)
</p>
<p>
※ もちろんこの時点では他の人はリモートリポジトリを更新してないので何も起きませんが push する前に pull する習慣をつけておくと良いです
</p>
<p>
<span class="olradio"><input type="radio" name="r2"></span> git push
</p>
<p>
※ GitHub のIDとパスワードを尋ねられます
</p>
<p>
<span class="olradio"><input type="radio" name="r2"></span> 全員がブラウザを開き、リモートリポジトリ「gitremote」の表示を更新し、hoge.txt の内容が変わっていることを確認する。
</p>
</div>
</div>

<p>
すると以下の状態5になります。
<br>
BさんのローカルリポジトリのHEADの内容がそのままリモートリポジトリにアップロードされている事が分かります。
<br>
ただし A、C、DさんのHEADはそのままです。
</p>

<br>
<br>
<h2>状態 5 (HEAD より前のコミットは省略)</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
</td></tr></table>
</td></tr></table>
"my name is C"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
</td></tr></table>
</td></tr></table>
"my name is D"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>

</td></tr></table>

<p>
では続けてCさんが pull ＆ pushし、終わったら最後に Dさんが pull ＆ push して以下の状態6にして下さい。
<br>
コミットのコメントは以下に合わせて下さい。
</p>

<br>
<h2>状態 6 (HEAD より前のコミットは省略)</h2>
<br>

<table><tr>

<td>
<b>Aさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>A
</td></tr></table>
</td></tr></table>
"my name is A"
</td>

</tr></table>
</td>

<td>
<b>Bさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged A and B"
</td>

</tr></table>
</td>

<td>
<b>Cさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged C and AB"
</td>

</tr></table>
</td>

<td>
<b>Dさん</b>
<br>
<br>
<br>
<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>ローカルリポジトリ</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged D and ABC"
</td>

</tr></table>
</td>

</tr><tr><td colspan="4">

<b>リモートリポジトリ(origin)</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td class="left">
name?
<br>D
<br>C
<br>B
<br>A
</td></tr></table>
</td></tr></table>
"merged D and ABC"
</td>

</tr></table>

</td></tr></table>

<br>
<script>PreNext(4,5)</script>
</body>
</html>

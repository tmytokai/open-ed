<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="../../../common.css">
<title>ファイル内容の復元</title>
</head>
<body>

<p>
<a href="../">アクティビティ: git によるバージョン管理</a>
<br>
学習項目: [2] ローカルリポジトリ
</p>

<h2>ファイル内容の復元</h2>

<p>
次は作業中に何かやらかしてしまった時に、インデックスや指定したコミット内容にファイルを復元する方法について学びます。
<br>
なお現在の状態は前のページ同じく状態10のままと仮定します。
</p>

<br>
<h2>状態 10</h2>
<br>

<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
abcd
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
abc
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>


<br>
<br>
<b>ローカルリポジトリ「gitlocal」</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
"piyo.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"hoge.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~2
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"piyo.txtを追加"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~3
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
</td></tr></table>
"hoge.txtを追加"
</td>

</tr></table>

<br>
<h3>
1. ワーキングツリーにあるファイルをインデックスの内容で復元
</h3>

<p>
まずはワーキングツリーにあるファイルをインデックスの内容で復元する方法です。
<br>
実際の開発中はよく使います。
</p>

<pre class="prog">
<input type="checkbox"><b>ワーキングツリーにあるファイルをインデックスの内容で復元:</b>

git checkout -- &lt;ファイル名&gt;

※ ファイル名を「.」(ドット)にすると更新した全てのファイルを復元します
※ -- は git にブランチ切り替えするなと指示するためのオプションで省略可能です。
　ブランチ機能を使わないなら省略しても良いのですが付けておいた方が無難です。
</pre>

<p>
では演習として hoge.txt をインデックスの内容で復元してみましょう。
<br>
すると次の状態 11 になります。
<br>
ワーキングツリーの hoge.txt の内容がインデックスの hoge.txt の内容に戻っていることに注目して下さい。
</p>

<br>
<h2>状態 11</h2>
<br>

<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
abc
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
abc
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>


<br>
<br>
<b>ローカルリポジトリ「gitlocal」</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
"piyo.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"hoge.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~2
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"piyo.txtを追加"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~3
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
</td></tr></table>
"hoge.txtを追加"
</td>

</tr></table>

<br>
<h3>
2. ワーキングツリーとインデックスにあるファイルを指定したコミットの内容で復元
</h3>

<p>
次はワーキングツリーにあるファイルを指定したコミットの内容で復元する方法です。
<br>
なお、インデックスの内容も同時に更新されるので注意して下さい。
</p>

<pre class="prog">
<input type="checkbox"><b>ワーキングツリーとインデックスにあるファイルを指定したコミットの内容で復元:</b>

git checkout &lt;コミット&gt; -- &lt;ファイル名&gt;

※ ファイル名を「.」(ドット)にすると更新した全てのファイルを復元します
※ コミットの所を HEAD にすると HEAD の内容で復元します。
</pre>

<p>
では演習としてワーキングツリーとインデックスの hoge.txt を HEAD~2 の hoge.txt の内容で復元してみましょう。
<br>
すると次の状態 12 になります。
<br>
ワーキングツリーとインデックスの hoge.txt の内容は HEAD~2の内容に戻っていますが、HEAD の hoge.txt の内容はそのままであることに注目して下さい。
</p>

<br>
<h2>状態 12</h2>
<br>

<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>


<br>
<br>
<b>ローカルリポジトリ「gitlocal」</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
"piyo.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"hoge.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~2
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"piyo.txtを追加"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~3
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
</td></tr></table>
"hoge.txtを追加"
</td>

</tr></table>

<br>
<h3>
3. アンステージ ( インデックスにあるファイルを HEAD の内容に復元 )
</h3>

<p>
最後はインデックスにあるファイルを HEAD の内容に復元する方法です。
<br>
この行為は「アンステージ」と呼ばれ、ステージング(git add)をキャンセルしたい時に良く利用されています。
</p>

<pre class="prog">
<input type="checkbox"><b>アンステージ( git add のキャンセル):</b>

git reset HEAD &lt;ファイル&gt;

※ ファイル名を省略すると全てのファイルの git add をキャンセルします。
※ HEAD は省略可能です。
</pre>

<p>
では演習として hoge.txt をアンステージしてみましょう。
<br>
すると次の状態 13 になります。
<br>
インデックスの hoge.txt の内容は HEAD の hoge.txt 内容に戻っていますが、ワーキングツリーの hoge.txt の内容はそのままであることに注目して下さい。
</p>

<br>
<h2>状態 13</h2>
<br>

<b>ワーキングツリー</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>

<br>
<br>
<b>インデックス</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
</td>

</tr></table>


<br>
<br>
<b>ローカルリポジトリ「gitlocal」</b>
<br>
<table class="noborder"><tr>

<td class="noborder" style="width: 10em;">
HEAD
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
AB
</td></tr></table>
</td></tr></table>
"piyo.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
ab
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"hoge.txtを更新"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~2
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
piyo.txt
<table class="innerbox"><tr><td>
A
</td></tr></table>
</td></tr></table>
"piyo.txtを追加"
</td>

<td class="noborder">←</td>

<td class="noborder" style="width: 10em;">
HEAD~3
<table style="width: 100%;"><tr><td class="centerbold">
hoge.txt
<table class="innerbox"><tr><td>
a
</td></tr></table>
</td></tr></table>
"hoge.txtを追加"
</td>

</tr></table>

</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="../../../common.css">
<title>まとめ</title>
</head>
<body>

<p>
<a href="../">アクティビティ: git によるバージョン管理</a>
<br>
学習項目: [2] ローカルリポジトリ
</p>

<h2>まとめ</h2>

<table class="info"><tr><td class="info">
1. <a href="./page01.html">初期設定</a>
<ul>
<li>git を初めて使う場合、git config コマンドを使って自分のユーザーIDやメールアドレスを登録する</li>
<li>ホームディレクトリ直下に設定ファイル(.gitconfig)が出来る</li>
<li>設定を全てリセットしたい場合はその設定ファイルを消す</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
2. <a href="./page02.html">ローカルリポジトリの新規作成</a>
<ul>
<li>ローカルリポジトリの新規作成
<br>
　git init
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
3. <a href="./page03.html">新規ファイルの追加</a>
<ul>
<li>新規ファイルのインデックス登録
<br>
　git add &lt;ファイル名&gt;
</li>
<li>コミット実行
<br>
　git commit -m "コメント"
</li>
<li>現在のローカルリポジトリの状態を確認
<br>
　git status
</li>
<li>コミットログを確認
<br>
　git log
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
4. <a href="./page04.html">既存ファイルの更新</a>
<ul>
<li>更新したファイルをインデックスに登録
<br>
　git add &lt;ファイル名&gt;
</li>
<li>コミット実行
<br>
　git commit -m "コメント"
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
5. <a href="./page05.html">コミットの指定方法</a>
<ul>
<li>HEAD ・・・ 最新のコミット</li>
<li>HEAD~ または HEAD^ ・・・1つ前のコミット</li>
<li>HEAD~~ または HEAD^^ または HEAD~2 または HEAD^2 ・・・2つ前のコミット</li>
<li>HEAD~n または HEAD^n ・・・nつ前のコミット</li>
<li>Windowsのコマンドプロンプトではハットはエスケープ文字になるので「^」は「^^」と2回入力する必要あり</li>
<li>リビジョン番号(ハッシュ値)の調べ方
<br>
　(1) git log
<br>
　(2) 日付やコメントで対象となるコミットを見つける
<br>
　(3) commit の後にある英数字の羅列がリビジョン番号(ハッシュ値)
</li>
<li>指定したコミットの情報取得
<br>
　git show &lt;コミット&gt;　
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
6. <a href="./page06.html">ファイルの更新差分表示</a>
<ul>
<li>
ワーキングツリーとインデックス(インデックス → ワーキングツリー)間の差分
<br>
　git diff &lt;ファイル名&gt;
</li>
<li>ワーキングツリーと指定したコミット間(コミット → ワーキングツリー)の差分
<br>
　git diff &lt;コミット&gt; &lt;ファイル名&gt;
</li>
<li>インデックスと指定したコミット間(コミット → インデックス)の差分
<br>
　git diff --cached &lt;コミット&gt; &lt;ファイル名&gt;
</li>
<li>指定したコミット間(コミットA → コミットB)の差分
<br>
　git diff &lt;コミットA&gt; &lt;コミットB&gt; &lt;ファイル名&gt;
<p>
※ ファイル名を省略すると更新した全てのファイルの差分を表示します。
<br>
※ コミットの所を HEAD にすると HEAD との差分になります。
</p>
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
7. <a href="./page07.html">ファイル内容の復元</a>
<ul>
<li>ワーキングツリーにあるファイルをインデックスの内容で復元
<br>
　git checkout -- &lt;ファイル名&gt;

<p>
※ ファイル名を「.」(ドット)にすると更新した全てのファイルを復元します
<br>
※ -- は git にブランチ切り替えするなと指示するためのオプションで省略可能です。
<br>
　ブランチ機能を使わないなら省略しても良いのですが付けておいた方が無難です。
</p>
</li>
<li>ワーキングツリーとインデックスにあるファイルを指定したコミットの内容で復元
<br>
　git checkout &lt;コミット&gt; -- &lt;ファイル名&gt;

<p>
※ ファイル名を「.」(ドット)にすると更新した全てのファイルを復元します
<br>
※ コミットの所を HEAD にすると HEAD の内容で復元します。
</p>
</li>
<li>アンステージ( git add のキャンセル)
<br>
　git reset HEAD &lt;ファイル&gt;

<p>
※ ファイル名を省略すると全てのファイルの git add をキャンセルします。
<br>
※ HEAD は省略可能です。
</p>
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
8. <a href="./page08.html">ファイルの削除</a>
<ul>
<li>ワーキングツリーとインデックスからファイルを同時に消す
<br>
　git rm &lt;ファイル&gt;
</li>
<li>インデックスからファイルを消す(＝ git による管理を止める)
<br>
　git rm --cached &lt;ファイル&gt;
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
9. <a href="./page09.html">一時的に過去のコミットに戻る</a>

<ul>
<li>一時的に過去のコミットに戻る

<p>
(1) 対象コミットのハッシュを調べる
<br>
　git log
</p>

<p>
(2) ワーキングツリーとインデックスの内容を一時保存
<br>
　git stash
</p>

<p>
(3) 過去のコミットに戻る
<br>
　git checkout &lt;コミット&gt;
</p>

<p>
(4) ちゃんと過去に戻れたか確認
<br>
　git show
</p>

</li>

<li>元の状態に戻る

<p>
(1) 本来の HEAD (master) に戻る
<br>
　git checkout -f master
</p>

<p>
※ -f はワーキングツリーとインデックスの更新内容を全部捨てて
<br>
　強制的に master に戻ることを指示するオプションです
</p>

<p>
(2) ちゃんと元に戻れたか確認
<br>
git show
</p>

<p>
(3) ワーキングツリーとインデックスの内容を復元
<br>
git stash pop --index
</p>

<p>
※ --index はインデックスも復元するという意味のオプションです
</p>
</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
10. <a href="./page10.html">コミットの巻き戻し</a>

<ul>
<li>HEADの状態までワーキングツリーとインデックスを強制リセット( やや危険 )

<p>
　git reset --hard HEAD
</p>

<p>
※ HEAD 後に更新した内容が完全に全て消えるので実行する時は要注意
<br>
　ファイル内容の復元のテキストで学んだ
<br>
　git checkout HEAD -- .
<br>
　を使う方法と異なって add した新規ファイルも全て消えます
</p>

</li>

<li>N 回コミットを巻き戻す(安全な方法)

<p>
　(1) 以下のように revert コマンドを N 回繰り返す
<br>
　git revert -n HEAD
<br>
　git revert -n HEAD~1
<br>
　git revert -n HEAD~2
<br>
　：
<br>
　：
<br>
　git revert -n HEAD~(N-1)
</p>

<p>
　※ 1 回だけ巻き戻したい時は git revert -n HEAD だけで結構です。
<br>
　※ -n オプションを付けないと(有難迷惑なことに)コミットが実行されます。
</p>

<p>
　(2) diff コマンドで差分が無いか調べる
<br>
　git diff HEAD~N
</p>

<p>
　(3) コミットする
<br>
　git commit -m "N回巻き戻し"
</p>

</li>

<li>N 回コミットを巻き戻す(危険な方法)

<p>
　git reset --hard HEAD~N
</p>

<p>
　※ 更新した内容が完全に全て消えるので実行する時は要注意
</p>

</li>
</ul>
</td></tr></table>

<br>
<table class="info"><tr><td class="info">
11. <a href="./page11.html">その他</a>
<ul>
<li> ブランチ機能やその他の便利な機能については自分で勉強しよう。</li>
<li>コミットを行うタイミングは原則自由</li>
</ul>
</td></tr></table>

</body>
</html>

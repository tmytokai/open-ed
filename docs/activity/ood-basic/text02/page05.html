<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>5. ゲームパッドやキーボードによるオブジェクトの移動</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: オブジェクト指向開発入門</a></li>
<li>学習項目: [1] Unity2D の基本</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
ゲームパッドやキーボード上の指定したボタンを押しているかどうかを判定するには、Input というユーティリティクラスにある GetAxis〜、GetButton〜、GetKey〜メソッドを利用します。 
<br>
それらのメソッドは用途ごとに使い分けることが出来ますが、今回は GetAxisRaw メソッドと GetButton メソッドを用いることにします。
<br>
その他のメソッドの使い方は自分で調べて下さい。
</p>

<p>
まずGetAxisRaw メソッドは、ゲームパッドやカーソルキーなどの方向ボタンを押しているかどうか判定するメソッドです。
</p>

<div class="info">
<input type="checkbox"><b>方向ボタンを押しているか判定</b>
<pre class="wrap">
public static float Input.GetAxisRaw( "軸" );

戻り値(float): キー状態に従って -1 か 0 か 1 が戻る

"軸":
"Horizontal" なら右を押したら 1、左を押したら -1 、何も押さないと 0 が戻る
"Vertical" なら上を押したら 1、下を押したら -1、何も押さないと 0 が 戻る
</pre>
</div>

<p>
次に GetButton メソッドは、攻撃ボタンとかジャンプボタンなどのボタンを押しているかどうかを判定するメソッドです。
</p>

<div class="info">
<input type="checkbox"><b>指定したボタンを押しているか判定</b>
<pre class="wrap">
public static bool Input.GetButton( "ボタンの名前" );

戻り値(bool): 指定したボタンを押してれば true、押してなければ false が戻る 

"ボタンの名前":
"Fire1"、"Fire2"、"Fire3"、"Jump" など
</pre>
</div>

<p>
さてこれらのメソッドと前のページで学んだ Rigidbody2D の velocity を組み合わせればユーザーの入力に従って自由にオブジェクトを動かせるようになります。
<br>
ただし
</p>

<p>
「<b>Rigidbody2D のメソッドやプロパティを利用するコードは、Update メソッドではなくて FixedUpdate メソッド内に書かなければいけない</b>」
</p>

<p>
という制約があります(理由は自分で調べて下さい)ので、Rigidbody2D の velocity を値を変更するにはまず void FixedUpdate() というメソッドをスクリプトに追加してからその中に書きます。
</p>

<p>
例えばあるオブジェクトを(重力が 0 なら) 方向キーで入力した方向に速度 2.0 で動かしたい場合はソース 1 の様に FixedUpdate メソッド内に書きます。 
</p>

<div class="info">
<input type="checkbox"><b>ソース 1: オブジェクトを方向ボタンで入力した方向に速度 2.0 で動かす</b>
<pre class="wrap">
float speed = 2.0f;
float x = Input.GetAxisRaw ("Horizontal"); // 右を押したら 1、左を押したら -1 、何も押さないと 0 が x に入る
float y = Input.GetAxisRaw ("Vertical"); // 上を押したら 1、下を押したら -1、何も押さないと 0 が y に入る
Vector2 v = new Vector2( x, y ).normalized; // ※ .normalized はベクトル v を長さ 1 に正規化するの意味
GetComponent&lt;Rigidbody2D&gt;().velocity = v * speed;
</pre>
</div>

<p>
ちなみに方向ボタンを向いたらオブジェクトの画像の向きもそれに合わせて変更したい場合があります。
<br>
それを実現するには、オブジェクトの画像の描画を担当している <b>Sprite Renderer</b> コンポーネントの flipX 又は FlipY プロパティの値を次のように変更します。
</p>

<div class="info">
<input type="checkbox"><b>画像の向きを反転させる</b>
<pre class="wrap">

GetComponent&lt;SpriteRenderer&gt;().flipX = false; // 左右通常の向き
GetComponent&lt;SpriteRenderer&gt;().flipX = true; // 左右反転

GetComponent&lt;SpriteRenderer&gt;().flipY = false; // 上下通常の向き
GetComponent&lt;SpriteRenderer&gt;().flipY = true; // 上下反転
</pre>
</div>


<br>
<script>PreNext(5,10)</script>
</body>
</html>

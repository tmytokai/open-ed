<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>5. KerasによるCNNの構築</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: TensorFlow/Keras によるディープラーニング</a></li>
<li>学習項目: [4] Keras を用いた CNN の学習</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
CNN は基本的には MLP と同じくフィードフォワード型のニューラルネットワークですのでモデルとしてSequential モデルを使います。
<br>
その後 add メソッドを使って各層を順々に積み重ねて作成します。
</p>

<p>
さて CNN では以下の層がよく使われています。
</p>

<br>
<h3>
1. 入力層: <a href="https://keras.io/api/layers/core_layers/input/">Inputクラス</a>)
</h3>

<p>
入力層の使い方は<a href="../text03/page02.html">MNP の時</a>と同じですが、CNN では他チャンネル画像を入力するので引数の指定の仕方が変わります。
</p>

<div class="info">
<pre class="wrap">
tf.keras.Input(shape=(rows,cols,Cin,))
</pre>
</div>

<p>
引数 に画像のサイズ(rows,cols)と入力画像のチャンネル数 Cin を指定します。
</p>


<br>
<h3>
2. 畳み込み層: <a href="https://keras.io/api/layers/convolution_layers/convolution2d/">Conv2Dクラス</a>
</h3>

<p>
<a href="./page04.html">前ページ</a>で説明した CNNのコアとなる層です。
</p>

<div class="info">
<pre class="wrap">
tf.keras.layers.Conv2D( Cout, (kernel_size,kernel_size),  activation='活性化関数' )
</pre>
</div>

<p>
引数 Cout はこの層から出力される画像のチャンネル数、kernel_size はカーネルのサイズです。
<br>
activation では活性化関数を指定します。
<br>
活性化関数としては 'tanh' (<a href="https://ja.wikipedia.org/wiki/%E5%8F%8C%E6%9B%B2%E7%B7%9A%E9%96%A2%E6%95%B0">双曲線正接</a>)や 'relu' (<a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">ReLU</a>)などがよく使われています。
</p>

<br>
<h3>
3. プーリング層: <a href="https://keras.io/api/layers/pooling_layers/max_pooling2d/">MaxPooling2Dクラス</a>、<a href="https://keras.io/api/layers/pooling_layers/average_pooling2d/">AveragePooling2Dクラス</a>
</h3>

<p>
入力画像を指定した大きさの窓で分割し、各窓の代表値を用いた縮小画像を出力する層です。
<br>
代表値の選び方として最大値を使う方法と平均値を使う方法があり、
</p>

<div class="info">
<pre class="wrap">
(最大値)  tf.keras.layers.MaxPooling2D( (pool_size, pool_size) )

(平均値)  tf.keras.layers.AveragePooling2D( (pool_size, pool_size) )
</pre>
</div>

<p>
というクラスがそれぞれの層に相当します。
<br>
なお引数 pool_size は窓のサイズで、入力した画像が 1/pool_size 倍になって出力されます。
</p>

<br>
<h3>
4. 平坦化層: <a href="https://keras.io/api/layers/reshaping_layers/flatten/">Flattenクラス</a>
</h3>

<div class="info">
<pre class="wrap">
tf.keras.layers.Flatten()
</pre>
</div>

<p>
は平坦化、つまり入力画像をチャンネルに関係なく全て1次元配列に変換して出力する層です。
<br>
全結合層 (<a href="https://keras.io/api/layers/core_layers/dense/">Denseクラス</a>)などに接続する前に使わます。
</p>

<br>
<h3>
5. ドロップアウト層: <a href="https://keras.io/api/layers/regularization_layers/dropout/">Dropoutクラス</a>
</h3>

<div class="info">
<pre class="wrap">
tf.keras.layers.Dropout( rate )
</pre>
</div>

<p>
「<a href="https://ja.wikipedia.org/wiki/%E9%81%8E%E5%89%B0%E9%81%A9%E5%90%88">過学習</a>(オーバーフィッティング)」、つまり実際のデータに適合していないモデルになることを防ぐための層です。
<br>
学習の際に rate で指定した確率に従ってランダムにデータを 0 にセットします。
</p>

<br>
<script>PreNext(5,6)</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<script src="../../../mathjax.js"></script>
<title>2. 3次元ベクトルの回転</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: 複素数と複素平面</a></li>
<li>学習項目: [3] クォータニオン</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
絶対値が 1 の複素数を掛ける事は 2 次元ベクトルの回転を表していました。
<br>
同様に絶対値が 1 のクォータニオンを掛ける事も 4 次元ベクトルの回転を表します。
</p>

<p>
ところで 3 次元空間は 4 次元空間の部分空間とみなせるので、うまくクォータニオンを決めてあげれば 3 次元ベクトルも回転できるはずです。
<br>
そこでここではクォータニオンを使った 3 次元ベクトルの回転について考えてみましょう。
</p>

<p>
まず回転させたい 3 次元ベクトルを $v = (x,y,z)$ とします。
<br>
$v$ のままだとクォータニオンの演算が出来ないので、$v$ を実部が 0 であるクォータニオンの虚部とみなして
</p>

\[
V = (0, v)
\]

<p>
というクォータニオン $V$ を作ります。
<br>
すると $V$ は実部が 0 である 3 次元部分空間上のベクトルになるので、実質的には $V$ も 3 次元ベクトルとみなすことが出来ます。
</p>

<p>
次に
</p>

\[
q = (w_q, v_q )
\]

<p>
を絶対値が 1 の任意のクォータニオンとします。
<br>
では早速 $q$ を $V$ に掛けてみて $V$ が回転するか確認してみましょう。
</p>

<p>
右と左のどちらから $q$ を掛けるかという問題がありますがとりあえず左から掛けてみます。
<br>
<a href="./page01.html">前ページ</a>で定義したハミルトン積を使って $qV$ の実部と虚部を計算すると以下の様になります。
<br>
ここで「$\cdot$」は内積で「$\times$」はクロス積です。
</p>

<p>
実部 :
</p>
\[
{\mathrm Re}[ qV ] = -v_q \cdot v
\]

<p>
虚部 :
</p>

\[
{\mathrm Im}[ qV ] = w_q v + v_q \times v
\]

<p>
すると $v_q$ か $v$ がゼロベクトルか、若しくは $v_q$ と $v$ が直交していない限り実部は 0 になりませんので、その様な特別な場合を除くと $qV$ は $V$ が存在している 3 次元部分空間上から飛び出して上位の 4 次元空間上にあるベクトルになります。
<br>
そこで 4 次元空間に行ってしまった $qV$ を何とかして元の 3 次元部分空間内に引き戻せないか考えてみましょう。
</p>

<p>
さて複素数の時は共役複素数を掛けることで回転をキャンセル出来ますので、同様に $q$ の共役クォータニオン
</p>

\[
q^* = (w_q, v^*_q)
\]

\[
v^*_q = -v_q
\]

<p>
をうまく使えば目的を果たせそうな気がします。
<br>
なお $|q|=1$なので、$q^*$ は $q$ の逆数 $q^{-1}$ でもあります。
</p>

<p>
では試しに $q^*$ を $qV$ の左から掛けてみましょう。
<br>
すると当たり前な気がしますが
</p>

\[
q^*qV = q^{-1}qV =  \vec{1}V = V
\]

<p>
※ $\vec{1} = (1,(0,0,0))$ は単位元
</p>

<p>
と回転がキャンセルされて元の $V$ が復元します。
</p>

<p>
確かに元の 3 次部分空間には戻ってきましたが回転がキャンセルされては意味が無いので、次は右から $q^*$ を掛けた $qVq^*$ を考えてみましょう。
<br>
するとこの場合は感覚に反して無回転にはならず、実部と虚部が次で表されるクォータニオンとなります。
<br>
ここで「$\cdot$」は内積で「$\times$」はクロス積です。
</p>

<p>
実部 
</p>
\begin{align*}
{\mathrm Re}[ qVq^* ] 
&= (-v_q \cdot v)w_q - (w_q v + v_q \times v)\cdot v^*_q \\
&= -w_q(v_q \cdot v) - w_q ( v \cdot v^*_q)  - (v_q \times v)\cdot v^*_q  \\
({\text スカラー3重積を使って}) &= -w_q(v_q \cdot v) + w_q( v \cdot v_q)  - (v^*_q \times v_q )\cdot v \\
&=  (v_q \times v_q )\cdot v \\
&=  0
\end{align*}

<p>
虚部 :
</p>

\begin{align*}
{\mathrm Im}[ qVq^* ] 
& = (-v_q \cdot v)v^*_q + w_q(w_q v + v_q \times v) + (w_q v + v_q \times v)\times v^*_q \\
& = (v_q \cdot v)v_q + w_q^2 v + w_q(v_q \times v) + w_q (v\times v^*_q) + v_q \times v \times v^*_q \\
& = (v_q \cdot v)v_q + w_q^2 v + w_q(v_q \times v) + w_q (v_q\times v) - v_q \times v \times v_q \\
({\text ベクトル3重積を使って}) & = (v_q \cdot v)v_q + w_q^2 v + 2 w_q(v_q \times v) - (v_q \cdot v_q )v + (v \cdot v_q) v_q \\
& = 2(v_q \cdot v)v_q + (w_q^2 - |v_q|^2)v + 2 w_q ( v_q \times v)
\end{align*}

<p>
この様に実部が 0 となるので $qV q^*$ は $V$ が存在している元の 3 次元部分空間上のベクトルとなります。
</p>

<p>
さらに
</p>

\[
v' = {\mathrm Im}[ qVq^* ] = 2(v_q \cdot v)v_q + (w_q^2 - |v_q|^2)v + 2 w_q ( v_q \times v)
\]

<p>
としたとき、
</p>

\[
|v'| = |qV q^*| = |q||V||q^*| = |V| = |v|
\]

<p>
が成り立ちます。
<br>
この様に $v$ から $v'$ に座標変換しても長さが不変なので、$v'$ は $v$ を回転して得られたベクトルだということが分かります。
</p>

<p>
以上をまとめると次の事が言えます。

<div class="info">
<input type="checkbox"><b>クォータニオンによる 3 次元ベクトルの回転 (一般論)</b>

<p>
ある 3 次元ベクトル $v$ から実部が0のクォータニオン
</p>

\[
V = (0, v)
\]

<p>
を作る。
<br>
絶対値が 1 である任意のクォータニオン $q$ に対し
</p>

\[
qVq^*
\]

<p>
を計算すると、その虚部
</p>

\[
v' = {\mathrm Im}[ qVq^* ] = 2(v_q \cdot v)v_q + (w_q^2 - |v_q|^2)v + 2 w_q ( v_q \times v)
\]

<p>
は $v$ を回転させた 3 次元ベクトルになる。
<br>
ここで「$\cdot$」は内積で「$\times$」はクロス積である。
</p>

</div>

<br>
<p>
次はどの様に $v$ は回転されているかについて考えます。
</p>

<p>
その目的のために、やや恣意的ではありますがクォータニオン $q$ の実部と虚部を次の式で置き換えます。
</p>


<p>
実部 : $w_q = \cos \frac{\theta}{2}$
</p>
<p>
虚部 : $v_q = (\sin \frac{\theta}{2} x_u\ ,\  \sin \frac{\theta}{2} y_u\ ,\  \sin \frac{\theta}{2} z_u)$
</p>
<p>
※ ただし $x_u^2 + y_u^2 + z_u^2 = 1$
</p>

<p>
この様に置き換えても $|q| = 1$ となっていますので、任意の $q$ は上の式を使って表すことができます。
</p>

<p>
さて計算は難しくありませんが長いので証明は省略しますが、結論を言うと、上の様に置き換えた $q$ を使って $v'$を求めることは<a href="https://ja.wikipedia.org/wiki/%E3%83%AD%E3%83%89%E3%83%AA%E3%82%B2%E3%82%B9%E3%81%AE%E5%9B%9E%E8%BB%A2%E5%85%AC%E5%BC%8F">ロドリゲスの回転公式</a>を使って $v'$ を求めることと同等になります。
</p>

<p>
よって最終的に次の事が言えます。
</p>

<div class="info">
<input type="checkbox"><b>クォータニオンによる 3 次元ベクトルの回転 (結論)</b>

<p>
ある 3 次元ベクトル $v$ から実部が0のクォータニオン
</p>

\[
V = (0, v)
\]

<p>
を作る。
<br>
さらに
</p>

<p>
実部 : $w_q = \cos \frac{\theta}{2}$
</p>
<p>
虚部 : $v_q = (\sin \frac{\theta}{2} x_u\ ,\  \sin \frac{\theta}{2} y_u\ ,\  \sin \frac{\theta}{2} z_u)$
</p>
<p>
※ ただし $x_u^2 + y_u^2 + z_u^2 = 1$
</p>

<p>
で表される任意のクォータニオン $q = (w_q,v_q)$ に対し
</p>

\[
qVq^*
\]

<p>
を計算すると、その虚部
</p>

\[
v' = {\mathrm Im}[ qVq^* ] = 2(v_q \cdot v)v_q + (w_q^2 - |v_q|^2)v + 2 w_q ( v_q \times v)
\]

<p>
は単位ベクトル $u = (x_u\ ,\  y_u\ ,\  z_u)$ を回転軸として $\theta$ [rad] だけ $v$ を回転させた 3 次元ベクトルになる。
<br>
ここで「$\cdot$」は内積で「$\times$」はクロス積である。
</p>

</div>

<p>
なお内積とクロス積による単純な演算しかないので、ロドリゲスの回転公式を使って回転させるよりクォータニオンを使って回転させた方がはるかに高速です。
<br>
そのため上の公式は至る分野で使われています。
</p>

<p>
では例を見てみましょう。
<p>

\[
v = (1 \ , \ 0 \ , \ -1)
\]

\[
\theta = \frac{2 \pi}{10}
\]

\[
u =  (x_u\ ,\  y_u\ ,\  z_u) = (1/\sqrt{2} \ , \ 0 \ , \ 1/\sqrt{2})
\]

<p>
とします。
<br>
$v$ を初期位置とし、9回連続で回転させた結果が図 1 です。
<br>
確かに回転軸 $u$ を中心に $\frac{2 \pi}{10}$ [rad] の角度で回転していることが分かります。
</p>

<div class="info">
<input type="checkbox"><b>図1: 回転の例</b>

<p>
赤い矢印 : 回転軸 $u$
<br>
大きい赤い丸 : 初期位置 $v$ 
<br>
小さい赤い丸 : 回転後の位置
</p>

<img src="./img/page02-fig1.png" alt="">
</div>


<br>
<script>PreNext(2,2)</script>
</body>
</html>

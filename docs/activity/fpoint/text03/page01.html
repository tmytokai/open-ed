<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<script src="../../../mathjax.js"></script>
<title>1. 浮動小数点数(IEEE754)</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: 浮動小数点数</a></li>
<li>学習項目: [3] 浮動小数点数</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
ここでは 10 進数の実数を「<a href="https://ja.wikipedia.org/wiki/%E6%B5%AE%E5%8B%95%E5%B0%8F%E6%95%B0%E7%82%B9%E6%95%B0">浮動小数点数</a>」形式の 2 進数に変換する方法について学びます。
</p>

<p>
浮動小数点数は<a href="../text02/page01.html">固定小数点数</a>と違って小数点の位置が固定されていないという形式です。
<br>
なお浮動小数点数を実現する方法はいくつかありますが、今回はもっともポピュラーな「<a href="https://ja.wikipedia.org/wiki/IEEE_754">IEEE754</a>」を用いる方法について学びます。 
</p>

<p>
さて IEEE754 では小数を次のようにして表しています。
</p>

<div class="info">
<input type="checkbox"> <b>浮動小数点数(IEEE754)</b>

<p>
符号部 + 指数部 + 仮数部
</p>

</div>

<p>
「<b>符号部</b>」は符号を表す部分です。
<br>
長さは 1 ビットで、0 のとき＋、1 の時はマイナスを表します。
</p>
<p>
「<b>指数部</b>」は小数点の位置を表す部分です。
</p>
<p>
「<b>仮数部</b>」は有効数字を表す部分です。
</p>

<p>
なお IEEE 754 では代表的な形式の全体や各部の長さ(ビット数)は以下の表1の様に決められています。
</p>

<p>
<b>表 1 : IEEE754 基本形式</b>
</p>
<table>
<tr> <th>形式</th> <th>全体</th> <th>符号部</th> <th>指数部</th> <th>仮数部</th> </tr>

<tr> <td class="center">半精度</td> <td class="center">16 ビット</td> <td class="center">1 ビット</td> <td class="center">5 ビット</td> <td class="center">10 ビット</td> </tr>
<tr> <td class="center">単精度(float)</td> <td class="center">32 ビット</td> <td class="center">1 ビット</td> <td class="center">8 ビット</td> <td class="center">23 ビット</td> </tr>
<tr> <td class="center">倍精度(double)</td> <td class="center">64 ビット</td> <td class="center">1 ビット</td> <td class="center">11 ビット</td> <td class="center">52 ビット</td> </tr>
<tr> <td class="center">倍々精度/4倍精度</td> <td class="center">128 ビット</td> <td class="center">1 ビット</td> <td class="center">15 ビット</td> <td class="center">112 ビット</td> </tr>

</table>

<p>
では 10 進数の実数を浮動小数点数形式に変換してみます。
</p>

<div class="info">
<input type="checkbox"> <b>10 進数の実数を浮動小数点数(IEEE754)形式の 2 進数に変換</b>

<p>
A を 10 進数の実数とする 
</p>

<ol>
<li>「符号部」を求める。元の値が 0 以上なら 0、 マイナスの値なら 1 
<li> Aの絶対値 |A| を<a href="../text02/page01.html">固定小数点数形式の2進数</a>に変換する(小数以下の有効桁数は十分に大きく取る)
<li> 小数点を左右に移動して整数部を 0b1 の 1 桁のみにする(※ 先頭に0が入っている場合は取り除く)。小数点を移動した回数を E とする(右方向がマイナス、左方向がプラス)
<li>「指数部」を求める。(3)で求めた E に $2^{(指数部の長さ-1)}-1$ (※下の補足参照)を足して 2 進数に変換する。表1で示した長さ(ビット数)になるように先頭を0で埋める
<li>「仮数部」を求める。(3)で求めた 2 進数の先頭から "0b1." を取り除いた部分を M とする。もしMが表1で示した長さ(ビット数)よりも大きい場合は末尾を丸める。逆にMの方が短い場合は末尾を0で埋める
<li> 符号部、指数部、仮数部の順につなげて 0b を先頭に付ける
</ol>

<p>
※ 補足
</p>
<p>
半精度の場合 → $2^{5-1}-1 = 15$ を E に足す
<br>
単精度の場合 → $2^{8-1}-1 = 127$ を E に足す
<br>
倍精度の場合 → $2^{11-1}-1 = 1023$ を E に足す
<br>
倍々精度の場合 → $2^{15-1}-1 = 16383$ を E に足す
</p>

</div>


<p>
逆にこの浮動小数点数形式で表された2進数を10進数に変換する方法は次の通りです
</p>

<div class="info">
<input type="checkbox"> <b>浮動小数点数(IEEE754)を10進数に変換</b>

<p>　</p>

<ol>
<li> 指数部の2進数を<a href="../text01/page01.html">10進数の整数に変換して</a> E に代入
<lI> E から $2^{(指数部の長さ-1)}-1$ を引く (※ 下の補足参照)
<li> 仮数部の先頭に「0b1.」を追加して固定小数点数変換する
<li> (3)で求めた固定小数点数の小数点の位置を E だけ移動する (右方向がプラス、左方向がマイナス)
<li> (5)で求めた<a href="../text02/page01.html">固定小数点数を10進数に戻す</a>
<li> 符号部が 1 ならマイナスを付ける 
</ol>

<p>
※ 補足
</p>
<p>
半精度の場合 → $2^{5-1}-1 = 15$ を E から引く
<br>
単精度の場合 → $2^{8-1}-1 = 127$ を E から引く
<br>
倍精度の場合 → $2^{11-1}-1 = 1023$ を E から引く
<br>
倍々精度の場合 → $2^{15-1}-1 = 16383$ を E から引く
</p>

</div>

<p>
では例として 10 進数 A = -12.625 を単精度浮動小数点数に変換してみます。
</p>

<div class="info">
<input type="checkbox"> <b>例: -12.625 を単精度(32ビット)浮動小数点数に変換</b>

<p>
A = -12.625 とする。
</p>

<ol>
<li>「符号部」を求める。A はマイナス値なので 符号部は 1
<li> A の絶対値 |-12.625| = 12.625 を固定小数点数形式の 2 進数に変換(整数部の桁数 4 ビット、小数部の有効桁数 4 ビット)すると 0b1100.1010  
<li> 小数点を「左に 3 回」移動して整数部を 0b1 の 1 桁だけにすると 0b1.1001010
<br>
左(プラス方向)に 3 回移動したので E = 3
<li>「指数部」を求める。単精度なので E に 127 を足した E = 130 を 2 進数に変換して 10000010 
<br>
なお今回は表1で示した指数部のビット数と比べると同じビット数(8ビット)なので先頭を0で埋めなくても良い
<li>「仮数部」を求める。(3)で求めた値の先頭から "0b1." を取り除いて M = 1001010
<br>
表1で示したビット数(23ビット) よりも M の方が短い(7ビット)ので、末尾を16個の 0で埋めて M = 10010100000000000000000
<li> 符号部、指数部、仮数部の順につなげて 0b を先頭に付けると -12.625 の単精度浮動小数点数は
<br><br>
0b_1_10000010_10010100000000000000000
<br><br>
(注) 見やすいように各部の間にアンダーバーを入れてますが、実際にはアンダーバーは入りません
</ol>

</div>

<p>
逆に単精度浮動小数点数 0b11000001010010100000000000000000 を 10 進数の実数に変換してみます。
</p>

<div class="info">
<input type="checkbox"> <b>例: 単精度浮動小数点数 0b11000001010010100000000000000000 を 10 進数の実数に変換</b>

<p>
0b 1_10000010_10010100000000000000000 の
<br>
符号部 = 1
<br>
指数部 = 10000010
<br>
仮数部 = 10010100000000000000000
</p>

<p>
なので
</p>

<ol>
<li> 指数部の2進数を 10 進数の整数に変換すると E = 130
<lI> 単精度なので、E から 127 を引いて E = 3 
<li> 仮数部の先頭に「0b1.」を追加して固定小数点数に変換すると 0b1.1001010 ※ 見づらいので末尾の 16 個の 0 は省略
<li> (3)で求めた固定小数点数の小数点の位置を E = 3 回(プラスなので右に)移動すると 0b1100.1010
<li> (4)で求めた<a href="../text02/page01.html">固定小数点数を10進数に戻す</a>と 12.625
<li> 符号部が 1 なのでマイナスを付けて -12.625
</ol>

</div>

<br>
<script>PreNext(1,3)</script>
</body>
</html>

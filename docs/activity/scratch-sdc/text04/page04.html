<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../seminar.css">
<style>
body.seminar{
background: #828282;
}
</style>
<title>4. Q値の配列の作成</title>
</head>
<body class="seminar">

<div class="container">

<div class="btback"><a href="../#text04">メニューへ戻る</a></div>
<div class="btback"><a href="./page03.html">前のページ</a></div>
<div class="btback"><a href="./page05.html">次のページ</a></div>

<div class="contents">

<h1>4. Q値の配列の作成</h1>

<div class="heading">
  <div class="number">1</div>
  <span>Q 値とは？</span>
</div>


<p>
もう一度おさらいすると、Q学習は車(エージェント)がある座標(状況)においてマップ(環境)からもらえる報酬が最大となる様な方向(行動)をトライ＆エラーを繰り返しながら学習していくアルゴリズムです。
</p>
<p>
具体的にはある座標で車がある方向を選んだらもらえるはずの「報酬の予測値」をQ学習を使って車は学習します。この報酬の予測値のことを<b>"Q値"</b>といいます。Q 値が分かれば実際に行動して報酬をもらう前に行動を選択することが出来るようになる訳ですね。
</p>

<p>
さてこうなると Q 値を記録する場所を用意する必要が出てきます。通常のプログラミング言語では<b>"配列"</b>というテクニックを使ってQ値を記録するのですが、残念ながら Scratch では配列を使うことが出来ません。
</p>

<p>
そこで今回はリストを使ってQ値の配列(もどき)を作ってみたいと思います。ただしリストを使った配列の作り方は複雑な数式が必要ですし、今回のセミナーの目的ともズレてますので、ここではプログラムを示すだけに留めておきたいと思います。
</p>

<p><br></p>
<div class="heading">
  <div class="number">2</div>
  <span>Q値の配列を初期化する</span>
</div>

<p>
まずQ値の配列の元になる「Q値の配列」をリストとして作成します。
</p>
<img src="./img/page04-fig1.png" alt="">

<p>
このリスト「Q値の配列」を初期化して配列を作るプログラムは次の様になります。「Q値の配列を初期化する」ブロックをブロック定義から作って下さい。なおこのブロックは1度しか実行しませんので「画面を再描画せずに実行する」はチェックしてもしなくても結構です。
</p>
<img src="./img/page04-fig2.png" alt="">

<p><br></p>
<div class="heading">
  <div class="number">3</div>
  <span>Q値をセットする</span>
</div>

<p>
次はある座標である行動をする場合における「Q値をセットする」ブロックをブロック定義から作ります。このブロックは繰り返し実行されますので「画面を再描画せずに実行する」は必ずチェックして下さい。
</p>
<img src="./img/page04-fig3.png" alt="">

<p>
緑の部分の式は次のようになっています。特に掛け算と足し算を間違わない様に気をつけてください。
</p>

<p>
<b>マップの高さ * 4 * Y座標 + 4 * X座標 + 行動</b>
</p>

<p><br></p>
<div class="heading">
  <div class="number">4</div>
  <span>Q値を求める</span>
</div>

<p>
次にある座標である行動をする時の「Q 値を求める」ブロックを作成します。
まず「Q値」という変数を作成します。
</p>
<img src="./img/page04-fig4.png" alt="">

<p>
次に「Q値を求める」ブロックをブロック定義から作ります。このブロックは繰り返し実行されますので「画面を再描画せずに実行する」は必ずチェックして下さい。
</p>
<img src="./img/page04-fig5.png" alt="">

<p>
緑の部分の式は上で示した式と同じなので複製すれば良いと思います。
</p>

<p><br></p>
<div class="heading">
  <div class="number">5</div>
  <span>テストする</span>
</div>

<p>
では上で作った3つのブロックのテストをしましょう。まず「緑の旗」を押した時に実行するテストプログラムを次の様に変更します。
プログラムを作りましたら。「緑の旗」ボタンを押してください。
</p>
<img src="./img/page04-fig6.png" alt="">

<p>
ではプログラムの中身について順を追って説明します。まず最初の「Q値の配列を初期化する」ブロックでは
</p>
<p>
<b>マップの幅 * マップの高さ * 4の長さで値が全て0のリストを作成する</b>
</p>
<p>
ということをしています。例えば幅と高さが9の場合は9x9x4=324となりますので、リスト「Q値の配列」の中身を表示すると次のようになります。
</p>
<img src="./img/page04-fig7.png" alt="">

<p>
次の「Q値をセットする」ブロック
</p>
<img src="./img/page04-fig8.png" alt="">

<p>
では
</p>
<p>
<b>車がX座標=1、Y座標=2の座標にいる時に下に移動(行動=3)する時のQ値を4にセットする</b>
</p>
<p>
ということをしています。
</p>

<p>
そして最後の「Q値を求める」ブロック
</p>
<img src="./img/page04-fig9.png" alt="">
<p>
では
</p>
<p>
<b>車がX座標=1、Y座標=2の座標にいる時に下に移動(行動=3)する時のQ値を求めて変数「Q値」に入れる</b>
</p>
<p>
ということをしていますので、変数「Q値」の値を表示して 4 となっていれば正常に動作しています。
</p>
<img src="./img/page04-fig10.png" alt="">

<p>
うまく動きましたらX座標、Y座標、行動、Q値の数値を色々変えてもきちんと動作するか確認して下さい。
確認が終わったらリスト「Q値の配列」と変数「Q値」は非表示に戻しておいて下さい。
</p>

</div>

<div class="btback"><a href="../#text04">メニューへ戻る</a></div>
<div class="btback"><a href="./page03.html">前のページ</a></div>
<div class="btback"><a href="./page05.html">次のページ</a></div>

</div>


</body>
</html>

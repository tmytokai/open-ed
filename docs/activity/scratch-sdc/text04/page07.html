<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../seminar.css">
<style>
body.seminar{
background: #828282;
}
</style>
<title>7. Q値を更新する</title>
</head>
<body class="seminar">

<div class="container">

<div class="btback"><a href="../#text04">メニューへ戻る</a></div>
<div class="btback"><a href="./page06.html">前のページ</a></div>
<div class="btback"><a href="./page08.html">次のページ</a></div>

<div class="contents">

<h1>7. Q値を更新する</h1>

<p><br></p>
<div class="heading">
  <div class="number">1</div>
  <span>Q値を更新する</span>
</div>


<p>
これでQ値に従って車を行動できるようになりました。ただし現時点ではQ値は全く変化しませんので、行動した後に得られる報酬を使ってQ値を更新する必要があります。
この更新を行う数式は結構難しいので、まずはプログラムを作ってから中身を説明したいと思います。
</p>

<p>
まず「学習率」という変数を作成します。 
</p>
<img src="./img/page07-fig1.png" alt="">

<p>
次に「Q値を更新する」ブロックをブロック定義から作ります。なおこのブロックは繰り返し実行されますので「画面を再描画せずに実行する」は必ずチェックして下さい。
</p>
<img src="./img/page07-fig2.png" alt="">

<p>
さてQ値を更新するタイミングは「行動した後」ですので、更新するQ値の座標は「行動後の位置」ではなく、「行動前の位置」になります。よって最初の「Q値を求める」ブロックで行動前の位置におけるQ値を求めています。
</p>

<p>
そして次の「Q値をセットする」ブロックでQ値を更新します。更新式は次のようになります。
</p>

<p>
<b>更新後のQ値 = (1-学習率) * 更新前のQ値 + 学習率 * 報酬</b>
</p>

<p>
「学習率」はどの位の学習効率でQ値を更新するかを決めるパラメータで 0 から 1 までの値を取ります。式を見ると分かるように学習率を 0 にすると全く Q 値を更新しなくなり、逆に 1 にすると更新後のQ値はいきなり報酬の値そのものになります。
</p>

<p>
あとで試してもらいますが学習率を 0 や 1 にすると学習がうまく行きません。そこで普通は学習率は 0.1 〜 0.5 くらいの値にします。すると更新後のQ値はトライ＆エラーを繰り返しながら少しずつ更新されていくようになります。
</p>

<p><br></p>
<div class="heading">
  <div class="number">2</div>
  <span>テストする</span>
</div>

<p>
ではこのブロックのテストをしましょう。まず「緑の旗」を押した時に実行するテストプログラムを次の様に変更します。
プログラムを作りましたら。「緑の旗」ボタンを押してください。
</p>
<img src="./img/page07-fig3.png" alt="">

<p>
ではプログラムの中身について説明します。
まず学習率を 0.5 にセットし、車のスタート地点の左方向(行動=2)のQ値を 10 にします。すると「次の行動を決める」と「行動する」で車は左に移動しますが、そこは道の上ではありませんので報酬は -100 となります。よって
</p>


<p>
<b>更新後のQ値 = (1-0.5) * 10 + 0.5 * (-100) = 5 - 50 = -45</b>
</p>

<p>
とスタート地点の左方向のQ値が更新されます。実際に「Q値」の値を表示させてみて-45になっていればテスト成功です。
</p>
<img src="./img/page07-fig4.png" alt="">

<p>
うまく動きましたら「学習率」の数値や「Q値をセットする」のX座標、Y座標、行動の数値を色々変えるとどの様にQ値が更新されるのか試して下さい。
</p>

<p><br></p>
<div class="challenge"><p>チャレンジ</p></div>
<p>
実は今回使った Q 値の更新式は簡単なバージョンで、本来の Q 学習の更新式はもっと複雑になります。本来の更新式を調べてプログラムしてみましょう。
</p>


</div>

<div class="btback"><a href="../#text04">メニューへ戻る</a></div>
<div class="btback"><a href="./page06.html">前のページ</a></div>
<div class="btback"><a href="./page08.html">次のページ</a></div>

</div>


</body>
</html>

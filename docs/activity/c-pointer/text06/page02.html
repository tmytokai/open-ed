<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" href="../../../common.css">
<script src="../../../common.js"></script>
<title>2. 配列渡し</title>
</head>
<body>

<nav class="brcr">
<ol>
<li><a href="../">アクティビティ: メモリ空間とC言語のポインタ</a></li>
<li>学習項目: [6] 活用例(1) 関数へのポインタ渡し</li>
<li><script>GetTitle()</script></li>
</ol>
</nav>

<h2><script>GetTitle()</script></h2>

<p>
次は「ポインタ渡し」の一種である「配列渡し」について紹介します。
</p>

<br>
<h3>
1. 配列渡し
</h3>
<p>
「配列渡し」は「ポインタ渡し」の一種でポインタ変数を引数として使うことは同じですが、呼び出し元の実引数が変数ではなくて配列であるという違いがあります。では定義と例を見てみましょう。
</p>

<div class="info">
<input type="checkbox"><b>「配列渡し」による引数の定義と例:</b>

<p>
引数の型 *引数名
</p>

<pre class="wrap">
(定義の例) 

※ int *pa が引数定義
void HOGE( int *pa )
{
  ※ 関数の中で引数を使いたい時は *(pa+i)記法 や pa[i] 記法の好きな方を使う
   printf( "%d\n", *(pa+1) );
   pa[2] = 1;
}


(関数の呼び出し方の例)

int a[10];
※ 配列の先頭アドレスを渡す(アドレス演算子 &amp; を配列名の前に付けない)
HOGE( a );
</pre>

</div>

<p>
繰り返しますが「配列渡し」は「ポインタ渡し」の一種ですのでメリット・デメリットも「ポインタ渡し」とほぼ同じです。つまり、
</p>

<div class="info">
<input type="checkbox"><b>配列渡しのメリット:</b>

<p>
<b>関数の中で呼び出し元の配列(実引数)の各要素の値を取得したり変更したり出来る</b>
</p>
</div>

<p>
というメリットがあります。
</p>

<br>
<h3>
2. 配列渡しの別の記法
</h3>
<p>
上で説明したポインタ変数を引数とする配列渡しの方法以外にも次のような記法があります。
</p>

<div class="info">
<input type="checkbox"><b>「配列渡し」の引数定義の記法:</b>

<p>
(1) 引数の型 *引数名

</p>
<p>
　※ 上で説明したポインタ変数を使う方法です。
</p>

<p>
(2) 引数の型 引数名[要素数]
</p>

<p>
　※ 呼び出し元の配列の要素数と合わせる必要があります。
</p>

<p>
(3) 引数の型 引数名[]
</p>

<br>
<pre class="wrap">
(記法 1 の例) 

※ int *pa が引数定義
void HOGE( int *pa )
{
   略
}


(記法 2 の例) 

※ int pa[10] が引数定義
void HOGE( int pa[10] )
{
   略
}

(記法 3 の例) 

※ int pa[] が引数定義
void HOGE( int pa[] )
{
   略
}

※ 関数の呼び出し方はどの記法も同じ

</pre>

</div>

<p>
呼び出し元の配列が 1 次元配列ならどの記法を使っても同じ結果になりますので(※)基本的に好みの記法を使って結構です。
</p>

<p>
※ 呼び出し元の配列が 2 次元配列などの多次元配列になると結果が変わってくるので注意が必要です。
</p>


<br>
<h3>
3. 配列渡しの動作
</h3>

<p>
では「配列渡し」の動作についてメモリ空間を使って説明して行きます。
<br>
まずは以下のソース1を実行して下さい。
</p>

<div class="info">
<input type="checkbox"><b>ソース 1: 配列渡しの例</b>

<pre class="wrap">
#include &lt;stdio.h&gt;

void HOGE( char *pa ) // <b>← ポインタ渡しと同じく * 付き</b>
{
   // ☆2

   pa[0] = 12;   //   <b>←  *(pa+i)記法 と pa[i] 記法の好きな方を使える</b>
   *(pa+1) = 34; //   <b>←  *(pa+i)記法 と pa[i] 記法の好きな方を使える</b>
   pa[2] = 56;   //   <b>←  *(pa+i)記法 と pa[i] 記法の好きな方を使える</b>

   // ☆3
}

int main()
{
   char a[3];
   a[0] = 100;   // a[0] に 100 を代入する
   a[1] = 101;   // a[1] に 101 を代入する
   a[2] = 102;   // a[2] に 102 を代入する

   // ☆1

   HOGE( a ); // <b>← ポインタ渡しと違って配列の先頭アドレスを渡す</b>

   // ☆4
   printf("a[0] = %d\n", a[0] ); // <b>12 と表示される</b>
   printf("a[1] = %d\n", a[1] ); // <b>34 と表示される</b>
   printf("a[2] = %d\n", a[2] ); // <b>56 と表示される</b>

   return 0;
}
</pre>

</div>

<p>
では動作解説します。 
</p>

<p>
ソース 1 の main 関数から始まって ☆1 まで進んだとします。
すると ☆1 時点におけるメモリ空間の状態は図1の様になります。
</p>

<p>
まだ HOGE 関数の中に入っていませんので、「main 関数の配列 a」だけが定義され、各配列要素にはそれぞれ 100、101、102 が入っています。
</p>

<div class="info">
<input type="checkbox"><b>図1: ☆1 時点におけるメモリ空間の状態 </b>
<p>
※ 例なのでアドレスは適当です。
</p>
<img src="./img/page02-fig1.png" alt="">
</div>

<p>
このまま HOGE 関数の中の ☆2 までプログラムを進めてみます。
</p>

<p>
HOGE 関数の引数としてポインタ変数「char *pa」が指定されており、 更に main 関数から HOGE 関数を呼び出す時に a の先頭アドレスが渡されていますので、「ポインタ渡し」の時と同様に
</p>

<p>
<b>HOGE 関数に入る直前に char 型のポインタ変数 pa が作られ、「main 関数の配列 a」の先頭アドレスが「 HOGE 関数のポインタ変数 pa 」に代入されます。</b>
</p>

<p>
その結果 ☆2 時点におけるメモリ空間の状態は図2の様になります。
</p>

<div class="info">
<input type="checkbox"><b>図2: ☆2 時点におけるメモリ空間の状態 </b>
<p>
※ 例なのでアドレスは適当です。
</p>
<img src="./img/page02-fig2.png" alt="">
</div>

<p>
そのまま ☆3 まで進みます。
</p>

<p>
☆3 の直前の 3 行を使って *(pa+i)記法 と pa[i] 記法を使って値が代入されていますが、
</p>

<p>
<b>pa[0] は「main 関数の a[0] 」を参照している(矢印で指し示している)ので「main 関数の a[0] 」に 12 が入ります。</b>
</p>
<p>
<b>*(pa+1) は「main 関数の a[1] 」を参照している(矢印で指し示している)ので「main 関数の a[1] 」に 34 が入ります。</b>
</p>
<p>
<b>pa[2] は「main 関数の a[2] 」を参照している(矢印で指し示している)ので「main 関数の a[2] 」に 56 が入ります。</b>
</p>

<p>
従って ☆3 時点におけるメモリ空間の状態は図 3 の様になります。
</p>

<div class="info">
<input type="checkbox"><b>図3: ☆3 時点におけるメモリ空間の状態 </b>
<p>
※ 例なのでアドレスは適当です。
</p>
<img src="./img/page02-fig3.png" alt="">
</div>

<p>
では HOGE 関数を抜けて main 関数に戻り、☆4 まで進みます。
<br>
</p>

<p>
HOGE 関数を抜けた瞬間に「HOGE 関数のポインタ変数 pa 」は消えて無くなりますので、よって ☆4 時点におけるメモリ空間の状態は図 4 の様になります。
</p>

<div class="info">
<input type="checkbox"><b>図4: ☆4 時点におけるメモリ空間の状態 </b>
<p>
※ 例なのでアドレスは適当です。
</p>
<img src="./img/page02-fig4.png" alt="">
</div>

<p>
以上の説明から、「配列渡し」を使うと、関数の中から元の配列の値も変えることが出来ることが理解できたと思います。
</p>

<script>PreNext(2,4)</script>
</body>
</html>

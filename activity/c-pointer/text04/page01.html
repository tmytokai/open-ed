<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="../../../common.css">
<title>変数とポインタ変数</title>
</head>
<body>

<p>
<a href="../">アクティビティ: C言語のポインタ</a>
<br>
学習項目: [4] 変数とポインタ変数
</p>

<h2>変数とポインタ変数</h2>

<p>
ではいよいよ「ポインタ変数」について学んでいきましょう。
<br>
ポインタ変数とは何か？を一言で表すと以下のようになります。
</p>

<pre class="prog">
<input type="checkbox"><b>ポインタ変数とは？:</b>

アドレス値(番地)を保存する変数
</pre>

<p>
まずはこれが全ての大前提になりますので覚えましょう(※)。
</p>

<p>
※ やたら難しくポインタ変数を説明している解説が多いのですが、ポインタ変数はこれ以上の物でもこれ以下の物でもありません。
</p>

<p>
それでこのポインタ変数にアドレスを入れておけば、CPU にそのアドレスにあるデータを使って何かしなさいとプログラム内で命令できるようになります。
</p>

<p>

</p>


<p>
ではまずポインタ変数の定義方法から説明します。
<br>
定義の仕方は簡単で、普通の変数のようにまずデータ型を書いた後にポインタ変数名の前に * を付けるだけです。
</p>

<pre class="prog">
<input type="checkbox"><b>ポインタ変数の定義方法:</b>

データ型 *ポインタ変数名;

(例) char *pa; とか int *pb;

※1 変数名の前に付いている p は pointer の意味です。
p を付けないと駄目という決まりは特にありませんが
付けておくと分かりやすいです。

※2 ポインタ変数はアドレスを入れる変数なので
ポインタ変数自体のデータサイズは使用するシステムのメモリ空間の広さ(＝アドレスの桁数)で決まります。
つまり char * 型だろうが int * 型だろうがポインタ変数のデータサイズは同じです。
詳しくは <a href="../text02/page01.html">ここのアドレス演算子の使い方</a>の所で書いた内容を復習して下さい。
</pre>

<p>
ここでデータ型をわざわざ指定する必要がある理由は次の通りです。
</p>

<p>
プログラムを実行する CPU からすると、何か適当なポインタ変数を与えられ、その中に入っているアドレスのデータを使えと命令されても、そのデータが何型の変数のデータなのか分からないのでどうしようもありません(図1)。
</p>

<p>
<input type="checkbox"><b>図1: ポインタ変数 pa に 0x01 が入っていて、CPU に pa 番地にあるデータを使えと命令されても・・・  (メモリの中の値は略)</b>
</p>
<table>
<tr>
<td class="centw50">0x00</td>
<td class="centw50">0x01</td>
<td class="centw50">0x02</td>
<td class="centw50">0x03</td>
<td class="centw50">0x04</td>
<td class="centw50">0x05</td>
</tr>

<tr>
<td class="centw50">略</td>
<td class="centw50">？</td>
<td class="centw50">略</td>
<td class="centw50">略</td>
<td class="centw50">略</td>
<td class="centw50">略</td>
</tr>
</table>
<p>
<b> → pa = 0x01 番地にあるデータが何型のデータなのか CPU は分からない！</b>

<br>
<p>
そこでポインタ変数を定義する時にデータ型を指定することでこの変数が何型のデータなのか CPU に知らせます(図2、図3)。
<br>
そうすることで CPU がそのアドレスにあるデータが何型のデータなのか分かるので、そのデータを利用することが出来るようになります。
</p>


<p>
<input type="checkbox"><b>図2: もし short *pa; と pa が定義されていたら・・・</b>
</p>
<table>
<tr>
<td class="centw50">0x00</td>
<td class="centw50">0x01</td>
<td class="centw50">0x02</td>
<td class="centw50">0x03</td>
<td class="centw50">0x04</td>
<td class="centw50">0x05</td>
</tr>

<tr>
<td class="centw50">略</td>
<td class="centw50" colspan="2">short型データ</td>
<td class="centw50">略</td>
<td class="centw50">略</td>
<td class="centw50">略</td>
</tr>
</table>
<p>
<b> → pa = 0x01 番地にあるデータは short 型なので 2 バイト使えば良い！</b>

<p>
<input type="checkbox"><b>図3: もし int *pa; と pa が定義されていたら・・・</b>
</p>
<table>
<tr>
<td class="centw50">0x00</td>
<td class="centw50">0x01</td>
<td class="centw50">0x02</td>
<td class="centw50">0x03</td>
<td class="centw50">0x04</td>
<td class="centw50">0x05</td>
</tr>

<tr>
<td class="centw50">略</td>
<td class="centw50" colspan="4">int型データ</td>
<td class="centw50">略</td>
</tr>
</table>
<p>
<b> → pa = 0x01 番地にあるデータは int 型なので 4 バイト使えば良い！</b>

<p>
次に、ポインタ変数にアドレス値を代入する方法は以下の 3 つです。
</p>

<pre class="prog">
<input type="checkbox"><b>ポインタ変数にアドレス値を代入する 3 つの方法:</b>

(1) アドレス値を直接代入

(2) アドレス演算子を使って変数のアドレスを代入

(3) 配列の先頭アドレスを代入
</pre>

<p>
このうち、(1) の方法はデバッグ時には良く使いますがあまり一般的ではないので今回は取り扱いません。
<br>
また(3)の方法は次の学習項目で取り扱いますので、ここでは(2)の方法について具体的に説明します。
</p>

<pre class="prog">
<input type="checkbox"><b>(2) アドレス演算子を使って変数のアドレスを代入する方法の詳細:</b>

ポインタ変数 = &amp;変数名

(例)

ポインタ変数に指定する型と変数の型は合わせる必要があります

short a;
ahort *pa;

pa = &amp;a;
</pre>

<p>
なお、この様にしてポインタ変数に変数のアドレスを代入することを「ポインタ変数に変数を参照させる」と言って、図では矢印で参照を表す場合が多いです。
<br>
例えば上の例の様に pa に short 型の変数 a を参照させた時のメモリ空間の例が図 1 です。
</p>

<pre class="prog">
<input type="checkbox"><b>図1: 矢印は「参照」を意味する: (クリックすると拡大します)</b>

short a = 100;   // OS が 0x01 番地(※1)から 2 バイト分を a の領域とし、a に 100 を代入する
short *pa; // OS が 0x04 番地(※2)から 2 バイト分(※2)を pa の領域とする
short pa = &amp;a;  // pa に a のアドレス、つまり今回は 0x01 を代入する

<a href="./img/page01-fig1.png"><img src="./img/page01-fig1.png" width="340" alt=""></a>

※1. あくまで例なのでアドレス値は適当に決めています。実際には OS がアドレスを決めます。

※2. 図の簡略化のためポインタ変数のデータサイズは 2 バイトにしていますが
実際には上の「ポインタ変数の定義方法」の※2 に書いたように
システムによってデータサイズは変わります。
</pre>


<p>
また図1 の矢印の先頭付近にある「*pa」は「間接演算子」又は「間接参照演算子」と言って、参照先、つまり矢印の先にある変数の値を取得したり、値を代入したりする事が出来ます。
</p>

<pre class="prog">
<input type="checkbox"><b>間接(参照)演算子の使い方:</b>

参照先の変数の値を取得したり値を代入出来る

*ポインタ変数名


(例) メモリ空間が図 1 の状態になっているなら

printf("%d\n", *pa );  ・・・ a の値(=100)を表示する

*pa = 1; ・・・ a に 1 を代入する

</pre>

</body>
</html>
